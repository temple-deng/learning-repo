# 第五章 Linux 的文件权限与目录配置

<!-- TOC -->

- [第五章 Linux 的文件权限与目录配置](#第五章-linux-的文件权限与目录配置)
  - [5.1 使用者与群组](#51-使用者与群组)
  - [5.2 文件权限概念](#52-文件权限概念)
    - [5.2.1 如何改变文件属性和权限](#521-如何改变文件属性和权限)
    - [5.2.2 权限对目录及文件的不同意义](#522-权限对目录及文件的不同意义)
    - [5.2.3 文件种类](#523-文件种类)
  - [5.3 Liunx 目录配置](#53-liunx-目录配置)
    - [FHS](#fhs)

<!-- /TOC -->

## 5.1 使用者与群组

在 Linux中，默认情况下，所以的系统账号与一般身份使用者，还有 root 的相关信息，都是记录正在
`/etc/passwd` 这个文件内的。至于个人的密码则是记录在 `/etc/shadow` 文件内。此外，所以群组的信息
记录在 `/etc/group` 内。     

## 5.2 文件权限概念

`ls -al` 命令结果的代表含义：   

1. 第一列是文件类型及权限内容
2. 第二列是文件的硬链接数
3. 第三列是拥有者
4. 第四列是所属组
5. 第五列是大小
6. 第六列是文件最后修改时间
7. 最后一列是文件名

+ 类型的类别：
  - d 表示目录
  - \-  表示文件
  - l 表示链接文件
  - b 表示设备文件里的可供存储的周边设备
  - c 表示设备文件中的鼠标、键盘等    

第二列表示有多少文件链接到此节点（i-node）。每个文件都会将他的权限和属性记录到文件系统的 i-node 中。     

### 5.2.1 如何改变文件属性和权限

+ chgrp：改变文件所属组
+ chown：改变文件所有者
+ chmod：改变文件的权限，SUID，SGID，SBIT等特性     

改变文件的所属组的组名必须要在 `/etc/group` 存在：    

```shell
# chgrp [options]  GROUP FILE
```    

同理，chown 的用户必须是系统中存在的账号。而且，chown 命令可以顺便也修改组的名称。    

```shell
# chown [-R] 账号名 文件或目录
# chown [-R] 账号名：群组名称 文件或目录
```    

事实上，chown 也支持将账号名和组名之间用小数点分割。甚至可以单纯的只修改组 `chown .sshd initial-setup-ks.cfg`。   

使用 chmod 设置权限的方式有两种，分别可以使用数字或者符号来处理。   

`# chmod -R xyz dirname/filename`   

`# chmod 777 .bashrc`    

由于文件的权限基本上就3种身份：user, group, others，因此可以用 u, g, o 来代表3种身份，此外 a 代表 all。    

```shell
# chmod u=rwx,go=rx .bashrc
# chmod a+w .bashrc
# chmod a-x .bashrc
```   

### 5.2.2 权限对目录及文件的不同意义

+ 权限对文件的意义：
  - r：可读取文件的内容。
  - w：可以编辑、新增或者是修改该文件的内容（但不含删除文件）
  - x：文件可以被执行
+ 权限对目录的意义：
  - r：表示具有读取目录结构清单的权限
  - w：表示具有改动目录结果清单的权限，具体来说包括：
    + 创建新的文件和目录
    + 删除已经存在的目录和文件
    + 将已存在的文件或目录进行更名
    + 搬移该目录内的文件、目录位置
  - x：表示使用者能否进入该目录称为工作目录的用途

### 5.2.3 文件种类

+ 常规文件：就是普通文件类型，第一个字符 `-`，依照文件的内容，可大致分为：
  - 纯文本文件
  - 二进制文件
  - 数据格式文件：有些程序在运行的过程当中会读取某些特定格式的文件，这些特定格式的文件被称为数据文件
+ 目录
+ 链接文件
+ 设备与设备文件：通常集中在 /dev 目录中，通常分为两种：
  - 块设备文件：就是一些存储数据，以提供系统随机读取的设备，比如说硬盘
  - 字符设备：例如键盘，鼠标。第一个属性为 c
+ 数据接口文件(sockets)：第一个属性为 s
+ 管道文件：FIFO，主要解决多个程序同时存取一个文件造成的错误。第一个属性为 p(pipe)

## 5.3 Liunx 目录配置

### FHS

根据Filesystem Hierarchy Standard(FHS)的标准文件指出，它们的主要目的是希望让使用者可以
了解到已安装软件通常放置于哪个目录下，所以它们希望独立的软件开发商、操作系统制作者、以及想要
维护系统的使用者，都能够遵循FHS的标准。    

FHS依据文件系统使用的频繁与否与是否允许使用者随意变动，而将目录定义成为四种交换作用的形态。   

四个类型分别是什么：   

+ 可分享的：可以分享给其他系统挂载使用的目录，所以包括可执行文件和使用者的邮件等数据，是能够分享给网络上其他主机挂载用的目录
+ 不可分享的：自己机器上面运行的设备文件或者是与程序有关的socket文件等，由于仅与自身机器有关，所以不适合分享给其他主机
+ 不变的：有些数据是不会经常变动的，跟随者 distribution 而不变动。例如函数库，文件说明文件，系统管理员所管理的主机服务配置文件等。
+ 可变动的：经常改变的数据，例如登录文件，一般用户可自行接受的新闻群组等。     

事实上，FHS针对目录树架构仅定义出三层目录下面应该放置什么数据而已，分别是下面这三个目录的定义：    

+ /（根目录）：与开机系统有关
+ /usr(unix software resource)：与软件安装/执行有关
+ /var(variable)：与系统运行过程有关     

FHS建议，根目录所在分区越小越好，因为越大的分区数据越多，越容易出错，应用程序所安装的软件最后
不要与根目录放在同一个分区。根目录下面应该有下面这些次目录的存在才好：    

目录 | 应放置文件内容 
----------|---------
 /bin | 系统有很多放置可执行文件的目录，但/bin比较特殊。因为 /bin 放置的是在单人维护模式下还能够被操作的指令。在/bin下面的指令可以被root与一般账号所使用。
 /boot | 这个目录主要放置开机会使用到的文件，包括Linux核心文件以及开机菜单与开机所需配置文件等等。Linux kernel常用的文件名为：vmlinuz 
 /dev | 在 Linux 系统上，任何设备与周边设备都是以文件的形态存在于这个目录当中。
 /etc | 系统主要的配置文件几乎都放置在这个目录内，例如人员的账号密码。一般来说，这个目录下的各文件属性是可以让一般使用者查阅的，但只有 root 能修改。
 /lib | 系统的函数库非常的多，而 /lib 放置的则是在开机时会用到的函数库，以及在 /bin 或 /sbin 下面的指令会调用的函数库而已。
 /media | 可移除的设备，例如DVD。
 /mnt | 如果想要暂时挂载某些额外的设备，一般建议放置到这个目录中。
 /opt | 一般第三方软件放置到这里。
 /run | 系统开机后产生的各项信息可以放置到这里。
 /sbin | Linux 系统有很多指令是用来设置系统环境的，这些指令只有 root 才能够用来设置，其他人只能查询。放在 /sbin 下面的为开机过程需要的，里面包含了开机、修复、还原系统等指令。某些服务器软件程序，一般放到 /usr/sbin。本机自行安装的软件所产生的系统可执行文件，则放到 /usr/local/sbin。
 /srv | service，是一些网络服务启动之后，这些服务所需要取用的数据目录。
 /tmp | 略
 /usr | 第二层 FHS 设置，稍后介绍
 /var | 同上   

除了上面标准定义的，还有一些目录也要了解以下：    


目录 | 应放置文件内容
---------|----------
 /lost+found | 这个目录是使用标准的ext2/ext3/ext4文件系统格式才会产生的一个目录,
目的在于当文件系统发生错误时,	将一些遗失的片段放置到这个目录下。
不过如果使用的是	xfs	文件系统的话,就不会存在这个目录了!
 /proc | 这个目录本身是一个“虚拟文件系统(virtual	filesystem)”喔!他放置的数
据都是在内存当中,	例如系统核心、行程信息(process)、周边设备的
状态及网络状态等等。因为这个目录下的数据都是在内存当中,	所以本身
不占任何硬盘空间
 /sys | 这个目录其实跟/proc非常类似,也是一个虚拟的文件系统,主要也是记录
核心与系统硬件信息较相关的信息。	包括目前已载入的核心模块与核心侦
测到的硬件设备信息等等。这个目录同样不占硬盘容量

**/usr**    

所有系统默认的软件（系统绑定的软件）都会放置到 /usr 下面。一般来说，/usr 的次目录建议有下面这些：    


目录 | 放置内容
----------|---------
 /usr/bin/ | 所有一般用户能使用的指令都放在这里。CentOS	7	已经将全部的使用者指令放置于此,而使用链接文件的方式将	/bin	链接至此
 /usr/lib/ | 基本上，与 /lib 功能相同，所有 /lib就是链接到此目录的
 /usr/local/ | 系统管理员在本机自行安装的软件
 /usr/sbin/ | 非系统正常运行所需要的系统指令。最常见的就是某些网络服务器软件的服务指令。与/sbin 差不多
 /usr/share/ | 主要放置只读架构的数据文件。
 /usr/games/ | 就是游戏数据的放置处
 /usr/include | c/c++ 等语言的 header 和 include 放置处
 /usr/libexec/ | 某些不被一般使用者惯用的可执行文件或脚本，放置在此目录中
 /usr/src | 一般源代码放置到这里   

**/var**    

常见的次目录有：    


目录 | 放置内容
----------|---------
 /var/cache/ | 应用程序运行过程中产生的一些缓存
 /var/lib/ | 程序本身执行过程中，需要用到的数据文件放置的目录
 /var/lock/ | 某些设备或者文件资源一次只能被一个应用程序使用，如果同时被两个使用，就可能产生错误。因此就要将该上锁，以确保该设备只会被单一软件所使用。
 /var/log/ | 登录文件放置的目录
 /var/mail/ | 放置个人电子邮箱的目录。不过这个目录也被放置到/var/spool/mail/ 目录中。通常这两个目录是互为链接文件
