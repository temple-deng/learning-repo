# 第 1 章 引言

<!-- TOC -->

- [第 1 章 引言](#第-1-章-引言)
  - [1.2 数据库系统的目标](#12-数据库系统的目标)
  - [1.3 数据视图](#13-数据视图)
    - [1.3.1 数据抽象](#131-数据抽象)
    - [1.3.2 实例和模式](#132-实例和模式)
    - [1.3.3 数据模型](#133-数据模型)
  - [1.4 数据库语言](#14-数据库语言)
    - [1.4.1 数据操纵语言](#141-数据操纵语言)
    - [1.4.2 数据定义语言](#142-数据定义语言)
  - [1.5 关系数据库](#15-关系数据库)
    - [1.5.2 数据操纵语言](#152-数据操纵语言)
    - [1.5.4 来自应用程序的数据库访问](#154-来自应用程序的数据库访问)
  - [1.6 数据库设计](#16-数据库设计)
    - [1.6.1 设计过程](#161-设计过程)
    - [1.6.3 实体 - 联系模型](#163-实体---联系模型)
    - [1.6.4 规范化](#164-规范化)
  - [1.7 数据存储和查询](#17-数据存储和查询)
    - [1.7.1 存储管理器](#171-存储管理器)
    - [1.7.2 查询处理器](#172-查询处理器)

<!-- /TOC -->

**数据库管理系统** 是一个由互相关联的数据的集合和一组用以访问这些数据的程序组成。这个数据集合
通常称作 **数据库**，其中包含了关于某个企业的信息。     

设计数据库系统的目的是管理大量信息。对数据的管理即涉及信息存储结构的定义，又涉及信息操作
机制的提供。此外，数据库系统还必须提供所存储信息的安全性保证，即使在系统崩溃或有人企图
越权访问时也应保障信息的安全性。如果数据将被多用户共享，那么系统还必须设法避免可能产生的
异常结果。    

## 1.2 数据库系统的目标

在文件处理系统中存储组织信息的主要弊端包括：    

+ **数据的冗余和不一致**。
+ **数据访问困难**。
+ **数据孤立**。由于数据分散在不同文件中，这些文件又可能具有不同的格式，因此编写新的应用
程序来检索适当数据是很困难的。
+ **完整性问题**
+ **原子性问题** 
+ **并发访问异常**
+ **安全性问题**   

## 1.3 数据视图

数据库系统的一个主要目的是给用户提供数据的抽象视图，也就是说，系统隐藏关于系统存储和维护
的某些细节。那其实一个表就是一个抽象视图。    

### 1.3.1 数据抽象

数据库系统开发人员通过如下几个层次上的抽象来对用户屏蔽复杂性，以简化用户和系统的交互：    

+ **物理层**。描述数据实际上是怎样存储的，即复杂的底层数据结构。
+ **逻辑层**。描述数据库中存储什么数据及这些数据间存在什么关系。这个其实就是我们通常数据
库管理员所能看到的那一层吧，比如说表。
+ **视图层**。只描述整个数据库的某个部分。数据库的很多用户并不需要关系所有的信息，而只需
要访问数据库的一部分。    

### 1.3.2 实例和模式    

随着时间的推移，信息会被插入和删除，数据库也就发生了改变。特定时刻存储在数据库中的信息的
集合称作数据库的一个**实例**。那这个信息应该即包括元信息，也包括数据信息吧。而数据库的
总体设计称作数据库**模式**。这个不是很懂。      

数据库模式对应于程序设计语言中的变量声明，每个变量在特定的时刻会有特定的值，程序中变量在
某一时刻的值对应于数据库模式的一个实例。   

根据我们前面所讨论的不同的抽象层次，数据库系统可以分为几种不同的模式。**物理模式** 在物理
层描述数据库的设计，而 **逻辑模式** 则在逻辑层描述数据库的设计。数据库在视图层也可以有几种
模式。   

### 1.3.3 数据模型

数据库结构的基础是**数据模型**。数据模型是一个描述数据、数据联系、数据语义以及一致性约束
的概念工具的集合。数据模型提供了一种描述物理层、逻辑层以及视图层数据库设计的方式。      

也就是说，实际来使用一个数据库的时候，是基于数据模型的，比如说关系型数据库都是基于关系模型实现的，
而设计数据库的时候是使用 E-R 模型设计的。    

数据模型可被划分为四类：    

+ 关系模型。关系模型用表的集合来表示数据和数据间的联系。每个表有多个列，每列有唯一的列名。
关系模型是基于记录的模型的一种。基于记录的模型的名称的由来是因为数据库是由若干种固定格式的记录
来构成的。每个表包含某种特定类型的记录。每个记录类型定义了固定数目的字段。表的列对应于记录类型
的属性。      
+ 实体 - 联系模型。E-R模型基于对现实世界的这样一种认识：现实世界由一组称作实体的基本对象以及
这些对象间的联系构成。实体-联系模型广泛应用于数据库设计。也就是说用 E-R 模型设计，然后基于
关系模型实现。
+ 基于对象的数据模型。可以看成是 E-R模型增加了封装、方法和对象标识等概念后的扩展。
+ 半结构化数据模型。允许那些相同类型的数据项含有不同的属性集的数据定义。XML 被广泛地用来表示
半结构化数据。     

## 1.4 数据库语言

数据库系统使用**数据定义语言**来定义数据库模式，以及**数据操纵语言**来表达数据库的查询和更新。
它们简单地构成了单一的数据库语言（例如SQL)的不同部分。      

### 1.4.1 数据操纵语言

数据操纵语言 DML 使得用户可以访问或操纵那些按照某种适当的数据模型组织起来的数据。有以下访问
类型：     

+ 对存储在数据库中信息进行检索。
+ 向数据库中插入新的信息。
+ 从数据库中删除信息。
+ 更新数据库中存储的信息。      

### 1.4.2 数据定义语言

数据库模式是通过一系列定义来说明的，这些定义由一种称作数据定义语言 DDL 的特殊语言来表达。     

存储在数据库中的数据值必须满足某些一致性约束。DDL 语言提供了指定这种约束的工具。每当数据库被更新
时，数据库系统都会检查这些约束。通常，约束可以是关于数据库的任意微词。然而，如果要测试任意
谓词，可能代价比较高。因此，数据库系统实现可以以最小代价测试的完整性约束。     

+ **域约束**。每个属性必须对应于一个所有可能的取值构成的域（例如整数型、字符型、日期型）。
+ **参照完整性**。我们常常希望，一个关系中给定属性集上的取值也在另一关系的某一属性集中的取值
中出现。
+ **断言**。一个断言就是数据库需要时刻满足的某一条件。域约束和参照完整性约束是断言的特殊形式。
然而，还有许多约束不能仅用这几种特殊形式表达。   
+ **授权**。我们也许相对用户加以区别，对于不同的用户在数据库中的不同的数据值上允许不同的访问
类型。这些区别以授权来表达，最常见的是：读权限、插入权限、更新权限和删除权限。       

DDL 以一些指令作为输入，生成一些输出。DDL 的输出放在**数据字典**中，数据字典包含了**元数据**。
可把数据字典看做一种特殊的表，这种表只能由数据库系统本身来访问和修改。      

## 1.5 关系数据库

### 1.5.2 数据操纵语言

SQL 查询语言是非过程化的。它以几个表作为输入（也可能只有一个），总是仅返回一个表。   

### 1.5.4 来自应用程序的数据库访问

为了访问数据库，DML 语言需要由宿主语言来执行。由两种途径可以做到这一点：    

+ 一种是通过提供 API，它可以用来将 DML 和 DDL 语句发送给数据库，再取回结果。与 C 语言一起使用
的开放数据库连接（ODBC)标准，是一种常用的 API 接口标准。Java 数据库连接（JDBC)标准为 Java
语言提供了相应的特性。
+ 另一种是通过扩展宿主语言的语法，在宿主语言的程序中嵌入 DML 调用，通常用一个特殊字符作为 DML
调用的开始，并且通过预处理器，称为DML预编译器，来将 DML 语言转变成宿主语言中过程调用。      

## 1.6 数据库设计

### 1.6.1 设计过程

从关系模型的角度来看，概念设计阶段设计决定数据库中应该包含哪些属性，以及如何将这些属性组织
到多个表中。后者主要是计算机科学的问题，解决这个问题主要有两种方法：一种是使用实体 - 联系
模型，另一种是引入一套算法（通称为 **规范化**），这套算法将所有属性集作为输入，生成一组
关系表。   

### 1.6.3 实体 - 联系模型

实体 - 联系数据模型使用一组称为 **实体** 的基本对象，以及这些对象间的 **联系**。   

数据库中实体通过 **属性** 集合来描述。**联系** 是几个实体之间的关联。同一类型的所有实体
的集合称作 **实体集**，同一类型的所有联系的集合称作 **联系集**。    

数据库的总体逻辑结构（模式）可以用实体 - 联系图进行图形化表示。有几种方法来画这样的图。
最常用的方法之一是采用 UML。在我们使用的基于 UML 的符号中，E-R 图如下表示：   

+ 实体集用矩形框表示，实体名在头部，属性名列在下面
+ 联系集用连接一对相关实体集的菱形表示，联系名放在菱形内部    

### 1.6.4 规范化

设计关系数据库所用到的另一种方法是通常被称为规范化的过程。它的目标是生成一个关系模式集合，使我们存储信息
时没有不必要的冗余，同时又能很容易地检索数据。这种方法是设计一种符合适当的范式的模式，为确定
一个关系模式是否符合想要的范式，我们需要额外的关于用数据库建模的现实世界中机构的信息。最常用
的方法是使用**函数依赖**。      

## 1.7 数据存储和查询

数据库系统划分为不同的模块，每个模块完成整个系统的一个功能。数据库系统的功能部件大致可分
为存储管理器和查询处理部件。     

所以存储管理器是处理数据在缓冲区和磁盘以及应用程序之间的数据存储、检索、更新等各方面的事情，
而查询处理部件，应该是将用户输入的查询语言翻译成存储管理器能理解的东西，并进行优化吧。   

### 1.7.1 存储管理器

存储管理器负责与文件管理器进行交互。原始数据通过操作系统提供的文件系统存储在磁盘上。存储管理器
将各种 DML 语句翻译为底层文件系统命令。因此，存储管理器负责数据库中数据的存储、检索和更新。    

存储管理部件包括：    

+ **权限及完整性管理器**，它检测是否满足完整性约束（什么是完整性约束），并检查试图访问数据的用户的
权限。
+ **事务管理器**，它保证即使发生了故障，数据库也保持在一致的状态，并保证并发事务的执行不发生冲突。
+ **文件管理器**，它管理磁盘存储空间的分配，管理用于用于表示磁盘上所存储信息的数据结构。
+ **缓冲区管理器**，它负责将数据从磁盘上取到内存中来，并决定哪些数据应被缓冲存储在内存中。    

存储管理器实现了几种数据结构，作为系统物理实现的一部分：    

+ **数据文件**，存储数据库自身。
+ **数据字典**，存储关于数据库结构的元数据，尤其是数据库模式。
+ **索引**，提供对数据项的快速访问。    


### 1.7.2 查询处理器

查询处理器组件包括：    

+ **DDL 解释器**，它解释 DDL 语句并将这些定义记录在数据字典中。
+ **DML 编译器**，将查询语言中的 DML 语句翻译为一个执行方案，包括一系列查询执行引擎能理解的低级
指令。一个查询通常可被翻译为多种等价的具有相同结果的执行方案的一种。DML 编译器还进行 **查询优化**，
也就是从几种选择中选出代价最小的一种。
+ **查询执行引擎**，执行由DML 编译器产生的低级指令。       

![system-arch](https://raw.githubusercontent.com/temple-deng/markdown-images/master/db/system-arch.png)