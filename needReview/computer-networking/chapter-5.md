# 第 5 章 链路层：链路、接入网和局域网

有两种截然不同类型的链路层信道。第一种类型是广播信道，这种信道用于连接有线局域网、卫星网和混合光纤同轴电缆（Hybrid Fiber Coaxial cable, HFC）接入网中的多台主机。因为许多主机与相同的广播信道连接，需要所谓的媒体访问协议来协调
帧传输。第二种类型的链路层信道是点对点通信链路，这在诸如长距离链路连接的两台路由器之间，或用户办公室
计算机与它们所连接的邻近以太网交换机之间等场合经常能够发现。     

## 5.1 链路层概述

在本章中，我们把运行链路层协议的任何设备均称为**结点**。结点包括主机、路由器、交换机和 WiFi 接入点。
我们也把沿着通信路径连接相邻结点的通信信道称为**链路**。    

### 5.1.1 链路层提供的服务

+ 成帧。在每个网络层数据报经链路传送之前，几乎所有的链路层协议都要将其用链路层帧封装起来。帧的结构由链路层
协议规定。
+ 链路接入。**媒体访问控制**（Medium Access Control, MAC）协议规定了帧在链路上传输的规则。
+ 可靠交付。链路层的可靠交付服务通常是通过确认和重传取得的。链路层可靠交付服务通常用于易于产生高差错率的
链路，例如无线链路，其目的是本地纠正一个差错，而不是通过运输层或应用层协议迫使进行端到端的数据重传。
+ 差错检测和纠正。    


### 5.1.2 链路层在何处实现

链路层的主体部分是在**网络适配器**中实现的，网络适配器有时也称为**网络接口卡**（Network Interface Card, NIC）。
位于网络适配器核心的是链路层控制器，该控制器通常是一个实现了许多链路层服务的专用芯片。因此，链路层控制器的
许多功能是用硬件实现的。      

在发送端，控制器取得了由协议栈较高层生成并存储在主机内存中的数据报，在链路层帧中封装该数据报，然后遵循链路
接入协议将该帧传送进通信链路中。在接收端，控制器接收了整个帧，抽取出网络层数据报。     

## 5.2 差错检测和纠正技术

在发送结点，为了保护比特免收差错，使用**差错检测和纠正比特**（Error-Detection and-Correctiong, EDC）来
增强数据 D。通常，要保护的数据不仅包括从网络层传递下来需要通过链路传输的数据报，而且包括链路帧首部中的
链路级的寻址信息、序号和其他手段。链路级帧中的数据报 D 和 EDC 都被发送到接收结点。在接收结点，接收到比特
序列 D' 和 EDC'。      

差错检测和纠正技术使接收方有时但并不总是检测出已经出现的比特差错。即使采用差错检测比特，也还是可能有
**未检出比特差错**；这就是说，接收方可能无法知道接收的信息中包含着比特差错。因此我们要选择一个差错检测
方案，使得这种事件发生的概率很小。     

目前在传输数据中检测差错有3种技术：奇偶校验、检验和方法（它通常用于传输层）和循环冗余检测（更常用于适配器
中的链路层）。     

### 5.2.1 奇偶校验

差错检测最简单的方式就是用单个**奇偶校验位**。假设要发送的数据 D 有 d 个比特。在偶校验方案中，发送方
只需包含一个附加的比特，选择它的值，使得这 d+1 个比特中 1 的总数是偶数。对应奇校验方案，选择校验
比特值使得有奇数个1。      

使用**二维奇偶校验**方案，包含比特值改变的列和行的校验值都将会出现差错。因此接收方不仅可以检测到出现了
差错，而且还可以利用存在奇偶校验差错的列和行的索引来实际识别发生差错的比特并纠正它。     

### 5.2.2 检验和方法

在检验和技术中，d 比特数据被作为一个 k 比特整数的序列处理。一个简单的检验和方法就是将这 k 比特整数加起来，
并且用得到的和作为差错检测比特。**因特网校验和**就是用这种方法，即数据的字节作为 16 比特的整数对待并求和。这个
和的反码形成了携带在报文段首部的因特网检验和。     

为什么传输层使用检验和而链路层使用 CRC。因为传输层差错检测用软件实现，采用简单而快速如检验和这样的
差错检测方案是重要的。在另一方面，链路层的差错检测在适配器中用专用的硬件实现，它能够快速执行更
复杂的 CRC 操作。     

### 5.2.3 循环冗余编码

现今的计算机网络中广泛应用的差错检测技术基于**循环冗余检测**（Cyclic Redundancy Check, CRC）**编码**。
CRC 编码也称为**多项式编码**，因为该编码能够将要发送的比特串看作为系数是 0 和 1 的一个多项式，对比特串
的操作被解释为多项式算术。    

CRC 编码操作如下，考虑 d 比特的数据 D。发送方和接收方必须协商一个 r+1 的比特模式，称为**生成多项式**，
我们将其表示为 G，我们要求 G 的最高有效位的比特是 1。对于一个给定的数据段 D，发送方要选择 r 个附加
比特R，并将它们附加到 D 上，使得得到的 d + r 比特模式用模 2 算术恰好能被 G 整除。      

## 5.3 多路访问链路和协议

前面提到有两种类型的网络链路：点对点链路和广播链路。**点对点链路**由链路一端的单个发送方和链路另一端的
单个接收方组成。许多链路层协议都是为点对点链路设计的，如点对点协议（peer-to-point, PPP）和高级
数据链路控制（high-level data link control, HDLC）就是两种这样的协议。第二种类型的链路是
**广播链路**，它能够让多个发送和接收结点都连接到相同的、单一的、共享的广播信道上。     

如何协调多个发送和接收结点对一个共享广播信道的访问，这就是**多路访问问题**，解决这个问题的协议就是
**多路访问协议**，即结点通过这些协议来规范它们在共享的广播信道上的传输行为。     

因为所有的结点都能够传输帧，所以多个结点可能会同时传输帧。当发生这种情况时，所有结点同时接到多个帧；这就是
说，传输的帧在所有的接收方处**碰撞**了。通常，当碰撞发生时，没有一个接收结点能够有效地获得任何传输的帧；
在某种意义下，碰撞帧的信号纠缠在了一起。因此，涉及此次碰撞的所有帧都丢失了，在碰撞时间间隔中的广播信道
被浪费了。      

这些年来，在大量的链路层技术中已经实现了几十种多路访问协议。尽管如此，我们能够将任何多路访问协议
划分成 3 种类型之一：**信道划分协议**，**随机接入协议**和**轮流协议**。     

在理想情况下，对于速率 R bps 的广播信道，多路访问协议应该具有以下所希望的特性：    

1. 当仅有一个结点有数据要发送时，该结点具有 R bps 的吞吐量；
2. 当有 M 个结点要发送数据时，每个结点吞吐量为 R/M bps。这不必要求 M 结点中的每一个结点总是有 R/M
的瞬间速率，而是每个结点在一些适当定义的时间间隔内应该有 R/M 的平均传输速率。
3. 协议是分散的，这就是说不会因某主结点故障而使整个系统崩溃
4. 协议是简单的，使实现不昂贵。    

### 5.3.1 信道划分协议

时分多路复用 TDM 和频分多路复用 FDM 是两种信道划分协议，但它们都有两个缺点：第一结点被限制于 R/N bps
的平均速率，即使它是信道中唯一要发送的结点，其次，结点必须在其分配到的时间或频率范围内发送，仍然不能良好
地利用信道。      

第三种信道划分协议是**码分多址**（Code Division Multiple Access, CDMA），CDMA 对每个结点分配一些
不同的编码。然后每个结点用它唯一的编码来对它发送的数据进行编码。如果精心选择这些编码，CDMA 网络具有一种
奇妙的特性，即不同的结点能够同时传输，并且它们各自相应的接收方仍能正确接收发送方编码的数据比特，而不在乎
其他结点的干扰传输。    

### 5.3.2 随机接入协议

在随机接入协议中，一个传输结点总是以信道的全部速率（即 R bps）进行发送。当有碰撞时，涉及碰撞的每个结点
反复地重发它的帧，到该帧无碰撞地通过为止。但是当一个结点经历一次碰撞时，它不必立刻重发该帧。相反，它在
重发该帧之前等待一个随机时延。涉及碰撞的每个结点独立地选择随机时延。      

在本节中，我们将描述一些最常用的随机接入协议，即 ALOHA 协议和载波侦听多路访问（CSMA）协议。以太网是一种
流行并广泛部署的 CSMA 协议。      

+ **1. 时隙 ALOHA**     

在对时隙 ALOHA 的描述中，我们做如下假设：    

+ 所有帧由 L 比特组成。
+ 时间被划分成长度为 L/R 秒的时隙（这就是说，一个时隙等于传输一帧的时间）
+ 结点只在时隙起点开始传输帧
+ 结点是同步的，每个结点都知道时隙何时开始
+ 如果在一个时隙中有两个或更多个帧碰撞，则所有结点在该时隙结束之前检测到该碰撞事件。     

在每个结点中，时隙 ALOHA 的操作是简单的：    

+ 当结点有一个新帧要发送时，它等到下一个时隙开始并在该时隙传输整个帧
+ 如果没有碰撞，该结点成功地传输它的帧，从而不需要考虑重传该帧
+ 如果有碰撞，该节点在时隙结束之前检测到这次碰撞。该结点以概率 p 在后续的每个时隙中重传它的帧，直到
该帧被无碰撞地传输出去。      

时隙 ALOHA 的问题是效率问题，即当时隙出现碰撞时，时隙被浪费了，而有时时隙可能又是空闲的，这样的时隙也被
浪费了。     

+ **2. ALOHA**

第一个 ALOHA 协议实际上是一个非时隙、完全分散的协议。在纯 ALOHA 中，当一帧首次到达（即一个网络层
数据报在发送结点从网络层传递下来），结点立刻将该帧完整地传输进广播信道。如果一个传输的帧以一个或多个
传输经历了碰撞，这个结点将立即（在完整传输完它的碰撞帧之后）以概率 p 重传该帧。否则，该结点等待
一个帧传输时间。在此等待之后，它则以概率 p 传输该帧。     

但是看书的意思，这个协议比时隙 ALOHA 协议的效率还低。     

+ **3. 载波侦听多路访问（CSMA）**     

**载波侦听**，即一个结点在传输前先听信道。如果来自另一个结点的帧正向信道上发送，结点则等待直到
检测到一小段时间没有传输，然后开始传输。      

**碰撞检测**，即当一个传输结点在传输时一直在侦听此信道。如果它检测到另一个结点正在传输干扰帧，它就停止
传输，在重复“侦听 - 当空闲时传输”循环之前等待一段随机时间。      

这两个规则包含在**载波侦听多路访问**（Carrier Sense Multiple Access, CSMA）和**具有碰撞检测的 CSMA**（CSMA with Collision Detection, CSMA/CD）协议族中。      

在多路访问协议中加入碰撞检测，通过不传输一个无用的、（由来自另一个结点的帧干扰）损坏的帧，将有助于改善
协议的性能。      

在分析 CSMA/CD 协议之前，我们现在从与广播信道相连的适配器（在结点中）的角度总结它的运行：     

1. 适配器从网络层一条获得数据报，准备链路层帧，并将其放入帧适配器缓存中。
2. 如果适配器侦听到信道空闲（即无信号能量从信道进入适配器），它开始传输帧。在另一方面，如果适配器侦听到信道正在忙，它
将等待，直到侦听到没有信号能量时才开始传输帧。
3. 在传输过程中，适配器监视来自其他使用该广播信道的适配器的信号能量的存在。
4. 如果适配器传输整个帧而未检测到来自其他适配器的信号能量，该适配器就完成了该帧。在另一方面，如果适配器在传输时检测
到来自其他适配器的信号能量，它中止传输。
5. 中止传输后，适配器等待一个随机时间量，然后返回步骤2。      

在选择时间间隔时，我们希望遵循这样的要求：当碰撞结点数量较少时，时间间隔较短；当碰撞结点数量较大时，时间间隔
较长。     

用于以太网以及 DOCSIS 电缆网络多路访问协议中的**二进制指数后退**算法，简练地解决了这个问题。特别是，
当传输一个给定帧时，在该帧经历了一连串的 n 次碰撞后，结点随机地从 {0, 1, 2, ..., 2<sup>n</sup>-1} 中选择
一个 K 值。因此，一个帧经历的碰撞越多，K 选择的间隔越大。对于以太网，一个结点等待的实际时间量是 K * 512 比特
时间（即发送 512 比特进入以太网所需时间量的 K 倍），n 能够取的最大值在 10 以内。     

看一个例子。假设一个适配器首次尝试传输一个帧，并在传输中它检测到碰撞。然后该结点以概率 0.5 选择 K=0，以
概率 0.5 选择 K=1。如果该结点选择 K=0，则它立即开始侦听信道。如果选择 K=1，它在开始侦听前等待 512 比特
时间（例如对于 100Mbps 以太网来说为 5.12 毫秒）。在第 2 次碰撞之后，从 {0, 1, 2, 3}中等概率地
选择 K。      

### 5.3.3 轮流协议

ALOHA 和 CSMA/CD 协议无法满足当有 M 个结点活跃时，每个活跃结点的吞吐量接近 R/M bps的特性。因此
研究人员又提出了**轮流协议**。和随机接入协议一样，有几十种轮流协议，其中每一个协议又都有很多变种。这里
我们讨论两种比较重要的协议。第一种是**轮询协议**。轮询协议要求这些结点之一要被指定为主结点。主结点以循环的方式
轮询每个结点。特别是，主结点首先向结点 1 发送一个报文，告诉它能够传输的帧的最多数量。      

轮询协议的缺点是，首先引入了轮询时延，每次都要先通知一下，其次如果主结点出问题，系统就崩了。    

第二种轮流协议是**令牌传递协议**。在这种协议中没有主结点。一个称为**令牌**的小的特殊帧在结点之间
以某种固定的次序进行交换。当一个结点收到令牌时，仅当它有一些帧要发送时，它才持有令牌，否则，立即向下一个结点
转发该令牌。也存在如果某一结点出问题不释放令牌，系统崩溃的问题。      

## 5.4 交换局域网

### 5.4.1 链路层寻址与 ARP

主机和路由器具有链路层地址。     

+ **1. MAC 地址**     

事实上，并不是主机和路由器具有链路层地址，而是它们的适配器（即网络接口）具有链路层地址。因此，具有多个网络
接口的主机或路由器将具有与之关联的多个链路层地址，就像它也具有与之关联的多个 IP 地址一样。然而，重要的
是注意到链路层交换机并不具有与它们的接口（这些接口是与主机和路由器相连的）相关联的链路层地址。这是
因为链路层交换机的任务是在主机和路由器之间承载数据报；这就是说，主机或路由器不必明确地将帧寻址到其间
的交换机。链路层地址有各种不同等待称呼：**LAN地址**、**物理地址**或**MAC 地址**。对于大多数局域网（包括
以太网和802.11 无线局域网）而言，MAC 地址长度为 6 字节，共有 2<sup>48</sup>个可能的 MAC 地址。地址
的每个字节被表示为一对十六进制数。尽管 MAC 地址被设计为永久的，但用软件改变一块适配器的 MAC 地址
现在是可能的。    

MAC 地址的一个有趣性质是没有两块适配器具有相同的地址。IEEE 在管理着 MAC 地址空间。当一个公司要生成
适配器时，它支付费用购买组成 2<sup>24</sup> 个地址的一块地址空间。IEEE 分配这块地址的方式是：固定一个
MAC 地址的前 24比特，让公司自己为每个适配器生成后 24 比特的唯一组合。    

当某适配器要向某些目的适配器发送一个帧时，发送适配器将目的适配器的 MAC 地址插入到该帧中，并将该帧
发送到局域网上。一台交换机偶尔将一个入帧广播到它的所有接口。因此一块适配器可以接收一个并非向它寻址的
帧。这样，当适配器接收到一个帧时，将检查该帧中的目的 MAC 地址是否与它自己的 MAC 地址匹配。如果匹配，该适配器
提取出封装的数据报，并将该数据报沿协议栈向上传递。如果不匹配，该适配器丢弃该帧，而不会向上传递该
网络层数据报。      

有时某发送适配器的确要让局域网上的所有其他适配器来接收并处理它打算发送的帧。在这种情况下，发送适配器在该
帧的目的地址字段中插入一个特殊的 **MAC 广播地址**。对于使用 6 字节地址的局域网，广播地址是 48 个
连续的 1 组成的字符串。      

+ **2. 地址解析协议**     

因为存在网络层地址和链路层地址，所以需要在它们之间进行转换，对于因特网而言，这是**地址解析协议**（Address Resolution
 Protocol, ARP）的任务。    

简单来说，在发送主机的 ARP 模块会取在相同局域网上的任何 IP 地址做输入，然后返回相应的 MAC 地址。    

每台主机或路由器在其内存中具有一个 **ARP 表**，这张表包含 IP 地址到 MAC 地址的映射关系，ARP 表
也包含了一个寿命（TTL）值，它指示了从表中删除每个映射的时间。注意到这张表不必为该子网上的每台主机
和路由器都包含一个选项；某些可能从来没有进入到该表中，某些可能已经过期。一个表项通常的过期时间是 20分钟。    

当发送方要发送报文个一个不在表项中的结点，其需要使用 ARP 协议来解析这个地址。
发送方构造一个称为**ARP 分组**的特殊分组，这个分组有几个字段，包括发送方和接收方的 IP 地址及 MAC 地址（注意
应该只有发送方的 MAC 地址）。ARP 查询分组和响应分组都具有相同的格式。ARP 查询分组的目的是询问子网上
所有其他主机和路由器，以确定对应于要解析的 IP 地址的那个 MAC 地址。      

适配器在链路层帧中封装这个 ARP 分组，用广播地址作为帧的目的地址，并将该帧传输进子网中。与 IP 地址匹配的
主机会给发送方发送一个带有所希望映射的响应 ARP 分组，然后发送方更新它的 ARP 表，并发送数据报。    

对于 ARP 协议有两点需要注意，首先，查询ARP 报文是在广播帧中发送的，而响应 ARP 报文在一个标准帧中发送。
其次，ARP 表是自动建立的，不需要系统管理员来配置。     

### 5.4.2 以太网

以太网是目前最流行的有线局域网技术。     

+ **1. 以太网帧结构**   

@TODO 此处该有图。    

以太网的 6 个字段：    

+ 数据字段（46~1500字节）。以太网的最大传输单元 MTU 为 1500字节。最小长度为 46字节，如果 IP 数据报
小于 46 字节，数据报必须被填充到 46字节。当采用填充时，传递到网络层的数据包括 IP 数据报和填充部分。
网络层使用 IP 数据报首部中的长度字段来去除填充部分。    
+ 目的地址（6字节）。这个字段包含目的适配器的 MAC 地址。
+ 源地址（6字节）。
+ 类型字段（2字节）。类型字段允许以太网复用多种网络层协议。也就是用来多路分解的。
+ CRC（4字节）。
+ 前同步码（8字节）。以太网帧以一个 8 字节的前同步码字段开始。该前同步码的前 7 字节的值都是 10101010；
最后一个字节是10101011。      

所有的以太网技术都向网络层提供无连接服务。     

+ **2. 以太网技术**     

以太网具有许多不同的特色，具有某种令人眼花缭乱的首字母缩写词，如 10BASE-T, 10BASE-2, 100BASE-T,
1000BASE-LX, 10GBASE-T。首字母缩写词的第一部分指该标准的速率。“BASE” 指基带以太网，这意味着该物理
媒体仅承载以太网流量。最后一部分指物理媒体本身。     

### 5.4.3 链路层交换机

交换机自身对子网中的主机和路由器都是**透明的**；这就是说，某主机/路由器向另一个主机/路由器寻址一个帧，
顺利将该帧发送进局域网，并不知道某交换机将会接收该帧并将它转发到另一个结点。     

+ **1. 交换机转发和过滤**    

**过滤**是决定一个帧应该转发到某个接口还是应当将其丢弃的交换机功能。**转发**是决定一个帧应该被导向哪个接口，并
把该帧移动到那些接口的交换机功能。交换机的过滤和转发借助于**交换机表**完成。该交换机表包含某局域网上某些主机和路由器
的但不必是全部的表项。交换机表中的一个表项包含：①一个 MAC 地址；②通向该 MAC 地址的交换机接口；③表项放置
在表中的时间。      

为了理解交换机过滤和转发的功能，假定目的地的为 DD-DD-DD-DD-DD-DD 的帧从交换机接口 x 到达。交换机
用MAC 地址 DD-DD-DD-DD-DD-DD 索引它的表。有 3种可能的情况：    

+ 表中没有对应表项。交换机向除接口 x 以外的所有接口前面的输出缓存转发该帧的副本。也就是广播该帧。
+ 有对应表项，但对应接口是 x。这种情况下，该帧从包括适配器DD-DD-DD-DD-DD-DD 的局域网段到来。无需将
该帧转发到任何其他接口，交换机通过丢弃该帧执行过滤功能即可。   
+ 有对应表项，且接口为 y != x，所以转发到接口 y 的输出缓存中。     


+ **2. 自学习**     

交换机得表是自动、动态和自治地建立的，即没有来网络管理员或来自配置协议的任何干预。换句话说，交换机是
**自学习**的。这种能力是通过如下方式实现的：   

1. 交换机表初始为空
2. 对于在每个接口接收到的每个入帧，该交换机在其表中存储：①该帧的源地址；②该帧到达的接口；③当前时间。
3. 如果在一段时间后，交换机没有接收到以该地址作为源地址的帧，就从表中删除这个地址。     


### 5.4.4 虚拟局域网

现实的交换机配置中有如下的缺点：    

+ 缺乏流量隔离。广播流量必须跨越整个局域网。而且安全性能也不够好。
+ 交换机的无效使用。
+ 管理用户。      

这些难题可以通过支持**虚拟局域网**（Virtual Local Network, VLAN）的交换机来处理。支持 VLAN 的
交换机允许经一个单一的物理局域网基础设施定义多个虚拟局域网。在一个 VLAN 内的主机彼此通信，仿佛它们与交换机
连接。在一个基于端口的 VLAN 中，交换机的端口由网络管理员划分成组。每个组构成一个 VLAN，在每个 VLAN 中的
端口形成一个广播域。VLAN 交换机配置的操作的方法，即网络管理员使用交换机管理软件声明一个端口属于某个
给定的 VLAN（其中未声明的端口属于一个默认的 VLAN），在交换机中维护一张端口到 VLAN 的映射表；交换机软件
仅在属于相同 VLAN 的端口之间交付帧。     

一种互联 VLAN 交换机的方法称为**VLAN 干线连接**（VLAN trunking）。每台交换机上的一个特殊端口被
配置为干线端口，以互联两台交换机。该干线端口属于所有 VLAN，发送到任何 VLAN 的帧经过干线链路转发
到其他交换机。但这会引发另外的问题：一个交换机怎样到达干线端口的帧属于某个特定的 VLAN 呢？IEEE 定义
了一种扩展的以太网帧格式-802.1Q，用于跨越 VLAN 干线的帧。802.1Q 帧由标准以太网帧与加进首部的 4 字节
**VLAN 标签**组成，VLAN 标签承载着该帧所属的 VLAN 标识符。VLAN 标签由在 VLAN 干线发送侧的交换机
加进帧中，解析后并由在 VLAN 干线接收侧的交换机删除。VLAN 标签自身由一个 2 字节的**标签协议标识符**字段
（具有固定的十六进制值 81-00）、一个2字节的标签控制信息字段（包含一个 12 比特的 VLAN 标识符字段）和一个
3比特优先权字段组成。      

## 5.6 数据中心网络

数据中心中的主机称为**刀片**。主机被堆叠在机架上，每个机架一般堆放20~40台刀片。在每个机架顶部有一台交换机，
这台交换机被形象地称为**机架顶部**（Top of Rack, TOR）**交换机**，它们与机架上的主机互联，
并与数据中心中的其他交换机互联。     

数据中心网络支持两种类型的流量：在外部客户和内部主机之间流动的流量，已经内部主机之间流动的流量。为了
处理外部客户与内部主机之间流动的流量，数据中心网络包括了一台或多台**边界路由器**，它们将数据中心网络与
公共因特网相连。     

### 5.6.1 负载均衡

一个云数据中心，如一个谷歌或者微软的数据中心，能够同时提供诸如搜索、电子邮件和视频应用等许多应用。为了支持
来自外部客户的请求，每一个应用都与一个公开可见的 IP 地址关联，外部用户向该地址发送其请求并从该地址接收
响应。在数据中心内部，外部请求首先被定向到一个**负载均衡器**。负载均衡器的任务是向主机分发请求，以主机
当前的负载作为函数来在主机之间均衡负载。一个大型的数据中心通常会有几台负载均衡器，每台服务于一组特定的
云应用。由于负载均衡器基于分组的目的端口号以及目的 IP 地址做决策，因此它们常常被称为 “第 4 层交换机”。
一旦接收到一个对于特定应用程序的请求，负载均衡器将该请求分发到处理该应用的某一台主机上（该主机可能再调用
其他主机的服务来协助处理该请求）。当主机处理完该请求后，向负载均衡器回送响应，再由负载均衡器将其中继
发回给外部客户。负载均衡器不仅平衡主机间的工作负载，而且还提供类似 NAT 的功能，将外部 IP 地址转换
为内部适当主机的 IP 地址，然后将反方向流向客户的分组按照相反的转换进行处理。      




