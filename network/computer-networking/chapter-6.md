# 第 6 章 无线网络和网络特征


<!-- TOC -->

- [6.1 概述](#61-概述)
- [6.2 无线链路和网络特征](#62-无线链路和网络特征)
- [6.3 WiFi：802.11 无线 LAN](#63-wifi80211-无线-lan)
  - [6.3.1 802.11 体系结构](#631-80211-体系结构)
  - [6.3.2 802.11 MAC 协议](#632-80211-mac-协议)
  - [6.3.3 IEEE 802.11 帧](#633-ieee-80211-帧)
  - [6.3.6 802.11 以外的标准：蓝牙和 ZigBee](#636-80211-以外的标准蓝牙和-zigbee)

<!-- /TOC -->

## 6.1 概述

在最高层次，我们能够根据两个准则来对无线网络分类：①在该无线网络中的分组是否跨越了一个无线跳或者多个
无线跳；②网络中是否有诸如基站这样的基础设施。    

+ 单跳，基于基础设施。这些网络具有与较大的有线网络连接的基站。802.11 网络，3G 蜂窝网络都属于这种类型。
+ 单跳，无基础设施。这些网络中不存在基站。在这种单跳网络中的以结点可以协调其他结点的传输。蓝牙网络
和具有自组织模式的 802.11 网络属于这种。感觉这种类似与用手机开 WiFi 热点，连入热点的主机组成一个 LAN。
+ 多跳，基于基础设施。某些无线传感网络和所谓无线网状网络属于这种。
+ 多跳，无基础设施。     

## 6.2 无线链路和网络特征

有线链路与无线链路有许多区别：    

+ 递减的信号强度。电磁波在穿过物体时强度将减弱。即使在自由空间中，信号仍将扩散，这使得信号强度随着发送方
和接收方距离的增加而减弱。
+ 来自其他源的干扰。在同一个频段发送信号的电波源将相互干扰。
+ 多径传播。当电磁波的一部分受物体和地面反射，在发送方和接收方之间走了不同长度的路径，则会出现**多径传播**。
这使得接收方收到的信号变得模糊。     

我们将注意力转向接收无线信号的主机。该主机接收到一个电磁信号，而该信号是发送方传输的初始信号的退化形式和环境中
背景噪声的结合。**信噪比**（SNR）是所收到的信号和噪声强度的相对测量。较大的 SNR 使接收方更容易从背景
噪声中提取传输的信号。     

## 6.3 WiFi：802.11 无线 LAN

有几套有关无线 LAN 的 802.11 标准，包括 802.11b, 802.11a, 802.11g。     


标准 | 频率范围 | 数据率
---------|----------|---------
 802.11b | 2.4~2.4835 GHz | 最高为 11 Mbps
 802.11a | 5.1~5.8 GHz | 最高为 54 Mbps
 802.11g | 2.4~2.485 GHz | 最高为 54 Mbps     

这些标准有许多相同的特征，例如，使用相同的媒体访问格式 CSMA/CA，链路层帧的格式也相同。     

### 6.3.1 802.11 体系结构

802.11 体系结构的基本构件模式是**基本服务集**（Basic Service Set, BSS）。一个 BSS 包含一个或多个
无线站点和一个在 802.11 术语中称为**接入点**（Access Point, AS）的中央基站。      

+ **信道与关联**    

在 802.11 中，每个无线站点在能够发送或者接收网络层数据之前，必须与一个 AP 相关联。   

当网络管理员安装一个 AP 时，管理员为该接入点分配一个单字或双字的**服务集标识符**（Service Set Identifier, SSID）。
管理员还必须为该 AP 分配一个信道号。为了理解信道号，回想前面提到的 802.11 运行中 2.4~2.4835 GHz 的频段中。
在这 85 MHz 的频段内，802.11 定义了 11个部分重叠的信道。当且仅当两个信道由 4 个或更多信道隔开时
它们才无重叠。特别是信道 1、6 和 11 的集合是唯一的 3 个非重叠信道的集合。这意味着管理员可以在同一个物理网络中安装
3个 AP，每个 AP 分配一个信道号。     

**WiFi 丛林**是一个任意物理位置，在这里的无线站点能从两个或多个 AP 中收到很强的信号。     

为了获得因特网接入，无线站点必须与一个 AP 相**关联**。关联意味着这一无线站点在自身和该 AP 之间创建了
一个虚拟线路。特别是，仅有关联的 AP 才向你的无线站点发送数据帧，并且你的无线站点也仅仅通过该关联 AP 向
因特网发送数据帧。     

802.11 标准要求每个 AP 周期性地发送**信标帧**，每个信标帧包括该 AP 的 SSID 和 MAC 地址。你的
无线站点为了得知正在发送信标帧的 AP，扫描 11 个信道，找出来自可能位于该区域的 AP 所发出的信标帧。通过
信标帧了解可用 AP 后，无线站点选择一个 AP 用于关联。      

扫描信道和监听信标帧的过程被称为**被动扫描**。无线站点也能够执行**主动扫描**，这是通过向位于无线主机
范围内的所有 AP 广播探测帧完成的。     

选定与之关联的 AP 后，无线主机向 AP 发送一个关联请求帧，并且该 AP 以一个关联响应帧
进行响应。      

为了与特定的 AP 创建一个关联，某无线站点可能要向该 AP 鉴别它自身。802.11 无线 LAN 提供了几种不同
的鉴别和接入方法。一种被许多公司采用的方法是，基于一个站点的 MAC 地址允许其接入一个无线网络。第二种
被许多因特网咖啡屋采用的方法是，应用用户名和口令。      

### 6.3.2 802.11 MAC 协议

因为许多站点可能希望同时经相同信道传输数据帧，因此需要一个多路访问协议来协调传输。802.11 的设计者
为 802.11 无线 LAN 选择了一种随机访问协议，这个随机访问协议称作**带碰撞避免的 CSMA**（CSMA with 
collision avoidance），或简称 CSMA/CA。尽管以太网和 802.11 都使用载波侦听随机接入，但这两种
MAC 协议有着重要的区别。首先，802.11 使用碰撞避免而非碰撞检测；其次，由于无线信道相对较高的误比特率，
802.11 使用链路层确认/重传（ARQ）方案。     

首先讨论下链路层确认的问题。目的站点（这里的站点应该即包括无线站点也包括 AP）收到一个通过 CRC 校验的帧后，它等待一个被称为**短帧间间隔**（Short Inter-Frame Spacing, SIFS）
的一小段时间，然后发回一个确认帧。如果发送站点在给定的时间内未收到确认帧，它假定出现了错误并重传该帧。      

下面是对 CSMA/CA 过程的讨论，假设一个站点（无线站点或 AP)有一个帧要发送。     

1. 如果初始时某站点监听到信道空闲，它将在一个被称作**分布式帧间间隔**（Distrbuted Inter-Frame Space, DIFS）
的短时间段后发送该帧。
2. 否则，该站点选取一个随机回退值，并且在侦听信道空闲时递减该值。当侦听到信道忙时，计数值保持不变。
3. 当计数值减为 0 时，该站点发送整个数据帧并等待确认。
4. 如果收到确认，发送站点知道它的帧已被目的站正确接收了。如果站点要发送另一帧，它将从第二步开始 CSMA/CA 协议。
如果未收到确认，发送站点将重新进入第二步中的回退阶段，并从一个更大的范围内选取随机值。      

+ **1. 处理隐藏终端：RTS 和 CTS**     

802.11 MAC 协议也包括一个极好的预约方案，以帮助在出现隐藏终端的情况下避免碰撞。隐藏终端是指可能两个
无线结点互相收不到对方的信号，结果误以为信道空闲开始传输数据。     

IEEE 802.11 协议允许站点使用短**请求发送**（Request To Send, RTS）控制帧和一个短**允许发送**（Clear To Send, CTS）
控制帧来预约对信道的访问。当发送方要发送一个 DATA 帧时，它能够首先向 AP 发送一个 RTS 帧，指示传输 DATA 帧
和确认（ACK）帧需要的总时间。当 AP 收到 RTS 帧后，它广播一个 CTS 帧作为响应。该 CTS 帧有两个
目的：给发送方明确的发送许可，也指示其他站点在预约期间内不要发送。     

尽管 RTS/CTS 交换有助于降低碰撞，但它同样引入了时延以及消耗了信道资源。因此，RTS/CTS 交换仅仅用于为长
数据帧预约信道。在实际中，每个无线站点可以设置一个 RTS 门限值，仅当帧长度超过门限值时，才使用 RTS/CTS 序列。
对许多无线站点来言，默认的 RTS 门限值大于最大帧长值，因此对所有发送的 DATA 帧，RTS/CTS 序列都被跳过。      

### 6.3.3 IEEE 802.11 帧

802.11 帧如图所示，在该帧上的每个字段上面的数字代表该字段的字节长度；在该帧控制字段中，每个子字段
上面的数字代表该子字段的比特长度。     

@TODO 此处该有图。     

+ **1. 有效载荷与 CRC 字段**

略。    

+ **2. 地址字段**     

出于互联的目的需要 3 个地址字段，特别是将网络层数据报从一个无线站点通过一个 AP 送到一台路由器接口。
当AP 在自组织模式中互相转发时使用第四个地址。由于我们这里仅仅考虑基础设施网络，所以只了解前3个地址字段：   

+ 地址 2是传输该帧的站点的 MAC 地址。类似于以太网中的源 MAC 地址。
+ 地址 1 是要接收该帧的无线站点的 MAC 地址。
+ 地址 3 是与 AP 相连的路由器接口的 MAC 地址，类似于目的 IP 地址。     

+ **3. 序号、持续期和帧控制字段**     

使用序号可以使接收方区分新传输的帧和以前的帧的重传。     

持续期字段即之前预约信道提供的传输时间，在数据帧和 RTS/CTS 中均存在。    

控制字段中，类型和子类型用于区分关联、RTS、CTS、ACK 和数据帧。To 和 From 用于定义不同地址字段的
含义（这些含义随着使用自组织模式或基础设施模式而改变）。最后，WEP 字段指示了是否使用加密。     

### 6.3.6 802.11 以外的标准：蓝牙和 ZigBee

IEEE 802.11 WiFi标准主要针对相距多达 100m 的设备间的通信。两个其他的 IEEE 802 协议——蓝牙和 ZigBee
（定义在 802.15.1 和 802.15.4），以及 WiMax（定义在 802.16），它们分别是用于短距离和长距离
通信的标准。     

+ **1. 蓝牙**     

802.15.1 网络以 TDM 方式工作于无需许可证的 2.4 GHz 无线电频段，每个时隙长度为 625 μs。在每个时隙
内，发送方利用 79 个信道中的一个进行传输，同时从时隙到时隙以一个已知的伪随机方式变更信道。这种被称作
**跳频扩展频谱**的信道跳动的形式将传输及时扩展到整个频谱。     

802.15.1 是自组织网络，不需要基础设施互联。802.15.1 设备首先组织成一个多达 8 个活动设备的**皮可网**。这些
设备之一被指定为主设备，其余充当从设备。主结点真正控制皮可网，即它的时钟确定了皮可网中的时间，它可以在每个
奇数时隙中发送，而从设备仅当主设备在前一时隙与其通信后才可以发送，并且只能发送给主设备。除了从设备，网络中
还可以有多达 255 个的寄放设备。这些设备仅当其状态被主结点从寄放转换为活动之后才可以进行通信。    

+ **2. ZigBee**    

ZigBee 的话比蓝牙功率、数据率和工作周期更低，比较适合家庭温度和光线传感器、安全设备和开关等。     


