# 第 12 章 远程版本库

要跟踪其他版本库中的数据，Git 使用远程跟踪分支。版本库中的每个远程跟踪分支都作为远程版本库中特定分支
的一个代理。要集成本地修改与远程跟踪分支对应的远程修改，可以建立一个本地跟踪分支来建立集成的基础。    

## 12.1 版本库概念

### 12.1.1 裸版本库和开发版本库

一个版本库要么是一个裸版本库，要么是一个开发版本库。    

`git clone --bare` 的话会克隆一个裸的版本库，但是`git init --bare` 的话应该是创建一个
新的裸版本库。两者的区别的话 clone 下的裸版本库应该有远程版本库中的对象，但 init 的话是一个
全新的版本库。    

### 12.1.2 版本库克隆

在正常使用 `git clone` 命令时，原始版本库中存储在 _refs/heads/_ 下的本地开发分支，会成为
新的克隆版本库中 _refs/remotes/_ 下的远程追踪分支，原始版本库中的标签被复制到克隆版本库中，然而，
版本库特定的信息，如原始版本库中的钩子、配置文件、引用日志和储藏都不在克隆中重现。    

Git 还用默认的 fetch refspec 配置默认的 origin 版本库：   

`fetch = +refs/heads/*:refs/remotes/origin/*`   

建立 refspec 预示你要通过从原始版本库中抓取变更来持续更新本地版本库。在这种情况下，远程版本库的分支
在克隆版本库中是可用的，只要在分支名前面加上 origin/ 前缀。    

### 12.1.3 远程版本库

除了 `git clone` 之外，跟远程版本库有关的其他常见的 Git 命令有：    

+ `git fetch`: 从远程版本库抓取对象及其相关的元数据。
+ `git pull`: 跟`git fetch` 类似，但合并修改到相应的本地分支。
+ `git push`: 转移对象及其相关的元数据到远程版本库。   
+ `git ls-remote`: 显示一个给定的远程版本库的引用列表。    

### 12.1.4 追踪分支

+ 远程追踪分支与远程版本库相关联，专门用来追踪远程版本库中每个分支的变化。
+ 本地追踪分支与远程追踪分支相配对。它是一种集成分支，用于收集本地开发和远程追踪分支中的变更。
+ 任何本地的非追踪分支通常称为特性或开发分支。
+ 最终，为了完成命名空间，远程分支是一个设在非本地的远程版本库的分支。很可能是远程追踪分支的上游源。   

因为远程追踪分支专门用于追踪另一个版本库的变化，所有你应该把它们当做是只读的。不应合并或提交到一个远程追踪
分支。这样做会导致远程追踪分支变得和远程版本库不同步。     

## 12.2 引用其他版本库

### 12.2.2 refspec

refspec 把远程版本库中的分支名映射到本地版本库中的分支名。    

refspec 语法：    

`[+]source:destination`    

如果有加号则表示不会在传输过程中进行正常的快进安全检查。     

refspec 在 `git fetch` `git push` `git pull` 中都使用。refspec 中的数据流如下：    


操作 | 源 | 目标
---------|----------|---------
 push | 推送的本地引用 | 更新的远程引用
 fetch | 抓取的远程引用 | 更新的本地引用
    
假如 `git fetch` 使用了如下的引用：`+refs/heads/*:refs/remotes/remote/*`。   

此处的 refspec 可以这样解释：在命名空间 _refs/heads/_中来自远程版本库的所有源分支映射到本地版本库，
使用由远程版本库名来构造名字，并放在_refs/remotes/remote_ 的命名空间中。    

假如在 `git push` 操作时有如下引用：`+refs/heads/*:refs/heads/*`。      

此处的 refspec 可以这样解释：从本地版本库中，将源命名空间 _refs/heads/_ 下发现的所有分支名，放在
远程版本库的目标命名空间 _refs/heads/_ 的匹配分支中，使用相似的名字来命名。    

如果在执行 `git push` 时没有指定 refspec，首先，如果命令种没有明确指定的远程版本库，Git 会假设
我们使用 origin。如果没有 refspec，`git push` 会将你的提交发送到远程版本库中你与上游版本库共存
的分支。不在上游版本库中的任何本地分支都不会发送到上游：分支必须存在，并且名字匹配。因此，新分支名
必须显式地用分支名来推送。    

