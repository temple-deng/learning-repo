# 第 1 章 计算机网络和因特网

<!-- TOC -->

- [第 1 章 计算机网络和因特网](#第-1-章-计算机网络和因特网)
  - [1.1 什么是因特网](#11-什么是因特网)
    - [1.1.1 具体构成描述](#111-具体构成描述)
  - [1.2 网络边缘](#12-网络边缘)
    - [1.2.1 接入网](#121-接入网)
    - [1.2.2 物理媒体](#122-物理媒体)
  - [1.3 网络核心](#13-网络核心)
    - [1.3.1 分组交换](#131-分组交换)
    - [1.3.2 电路交换](#132-电路交换)
  - [1.4 分组交换网中的时延、丢包和吞吐量](#14-分组交换网中的时延丢包和吞吐量)
    - [1.4.1 分组交换网中的时延概述](#141-分组交换网中的时延概述)
  - [1.5 协议层次及其服务模型](#15-协议层次及其服务模型)
    - [1.5.1 分层的体系结构](#151-分层的体系结构)
    - [1.5.2 封装](#152-封装)
  - [1.6 面对攻击的网络](#16-面对攻击的网络)
  - [总结](#总结)

<!-- /TOC -->

## 1.1 什么是因特网

注意因特网与计算机网络不可等同，只能说因特网是计算机网络的一种。什么是因特网？回答这个问题有两种
方式：其一，我们能够描述因特网的具体构成，即构成因特网的基本硬件和软件组件；其二，我们能够根据为分布式
应用提供服务的联网基础设施来描述因特网。    

### 1.1.1 具体构成描述

所有可以与因特网相连的计算设备都称为 **主机** 或 **端系统**。特意加了一个计算来区别交换机和路由器等网络基础设施。    

端系统通过 **通信链路** 和 **分组交换机** 连接到一起。有许多类型的通信链路，它们由不同类型的物理媒体组成。这些
物理媒体包括同轴电缆、铜线、光纤和无线电频谱。不同的链路能够以不同的速率传输数据，链路的 **传输速率** 以
比特/秒度量。当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上
首部字节。由此形成的信息包用计算网络的术语来说叫做 **分组**。这些分组通过网络发送到目的
端系统，在那里被装配成初始数据。       

分组交换机从它的一条入通信链路接收到达的分组，并从它的一条出通信链路转发该分组，在当今的因特网中，
两种最著名类型的分组交换机是 **路由器** 和 **链路层交换机**。链路层交换机常用于接入网中，而路由器通常
用于网络核心中。   

端系统通过 **因特网服务提供商**（Internet Service Provider, ISP）接入因特网。因特网就是
将端系统彼此互联，因此为端系统提供接入的 ISP 也必须互联。底层的 ISP 通过国家的、国际的高层
ISP 互联起来。高层 ISP 是由通过高速光纤链路互联的高速路由器组成。       

端系统、分组交换机和其他因特网部件都要运行一系列 **协议**，这些协议控制因特网中信息的接收和发送。    

一个协议定义了在两个或多个通信实体之间交换的报文格式和次序，以及报文发送和/或接受一条报文或其他事件所采取的动作。   

## 1.2 网络边缘

网络边缘无非就是端系统和将端系统连接到边缘路由器上的链路和交换机组成的一部分东东即接入网。    

### 1.2.1 接入网

**接入网**是指将端系统连接到其 **边缘路由器** 的物理链路。边缘路由器是端系统到任何其他远程端系统的路径上的第一台
路由器。下面介绍几种类型的接入链路和使用接入网的几种环境。   

注意，你任何一个端系统肯定要通过任意一种类型的接入网来连入互联网，这样你才能将分组发送到
网络核心中去。   

+ **1. 家庭接入：DSL、电缆、FTTH、拨号和卫星**     

几乎所有家庭都是经过高速宽带连接到因特网的。宽带住宅接入有两种最流行的类型：**数字用户线**（Digital Subscribe Line, DSL）
和电缆。住户通常从提供本地电话接入的本地电话公司处获得 DSL 因特网接入。每个用户的 DSL 调制解调器使用现有
的电话线与位于本地电话公司的本地中心局中的数字用户线接入复用器（DSLAM）来交换数据。家庭的 DSL 调制解调器得到
数字数据后将其转换为高频音，以通过电话线传输给本地中心局；来自许多家庭的模拟信号在 DSLAM 处被转换
为数字模式。    

家庭电话线同时承载了数据和传统的电话信号，它们编码为不同的频率：    

+ 高速下行信道，位于50kHz 到 1MHz 频段
+ 中速上行信道，位于4kHz 到 50kHz 频段
+ 普通的双向电话信道，位于0到4kHz 频段    

这种方法使单根 DSL 线路看起来就像有3根单独线路，因此一个电话呼叫和一个因特网连接能够同时共享 DSL 链路。
在用户一侧，一个分频器把到达家庭的数据信号和电话信号分隔开来，并将数据信号转发给DSL 调制解调器。    

当 DSL 利用本地电话公司现有的电话基础设施时，**电缆因特网接入**（cable Internet access）利用了有线
电视公司现有的有线电视基础设施。住宅从提供有线电视的公司获得了电缆因特网接入。光缆将电缆头端连接到
地区枢纽从这里使用传统的同轴电缆到达各家各户。因为在这个系统中应用了光纤和同轴电缆，所以经常
被称为混合光纤同轴（Hybrid Fiber Coax, HFC）。        

电缆因特网接入需要特殊的调制解调器，称为电缆调制解调器。在电缆头端，电缆调制解调器端接系统（Cable 
Modem Termination System, CMTS）起到如同 DSL 网络中 DSLAM 类似的功能，即将来自许多下行
家庭中的电缆调制解调器发送的模拟信号转换为数字形式。     

那么奇怪了，从上面的表述中感觉铜线和同轴电缆都传递的是模拟信号，那么第一个问题就是这两个物理媒体是传递
模拟信号的吗，第二个问题是在 HFC 中，电缆头与地区枢纽之间是使用光纤连接的，那这里的意思是光纤也能
传递模拟信号么，难道媒介与传递信号的种类没有关系么。    

电缆因特网接入的一个重要特征是共享广播媒体。特别是由头端发送的每个分组向下经每段链路到每个
家庭；每个家庭发送的每个分组经上行信道向头端传输。    

上面的 DSL 和电缆都是属于宽带接入，下面介绍光纤接入。    

**光纤到户**（Fiber To The Home, FTTH），从本地中心局直接到家庭提供了一条光纤路径。    

从本地中心局到家庭有几种竞争性的光纤分布方案。最简单的光纤分布网络称为直接光纤，从本地中心局到每户设置
一根光纤。更为一般的是，从中心局出来的每根光纤实际上由许多家庭共享，至到相对接近这些家庭的位置，该光纤才分为
每户一根光纤。进行这种划分的有两种竞争性的光纤分布体系结构：主动光纤网络（Active Optical Network, AON）
和被动光纤网络（Passive Optical Network, PON）。AON 基本上就是交换因特网，将在第5章进行讨论。    

这里简单介绍一下 PON，每个家庭具有一个光纤网络端接器（Optical Network Terminator, ONT），它由
专门的光纤连接到临近的分配器。该分配器把一些家庭集结到一根共享的光纤，该光纤再连接到本地电话和公司
的中心局中的光纤线路端接器（Optical Line Terminator, OLT）。该 OLT 提供了光信号到电信号的转换，经过
本地电话公司路由器与因特网相连。     

+ **2. 企业接入：以太网和 WIFI**     

在公司和大学中，通常是用局域网(LAN)将端用户连接到边缘路由器。有许多不同类型的局域网技术，但是以太网
是目前为止最为流行的接入技术。以太网用户使用双绞铜线与一台以太网交换机相连，以太网交换机或这样相连的交换机
网络，则再与更大的因特网相连。    

不过更多人使用无线设备接入到无线 LAN 环境中，基于 IEEE 802.11 技术的无线 LAN接入，更为通俗地称为
WiFi。    

+ **3. 广域无线接入：3G 和 LTE**   

通过蜂窝网提供商运营的基站来发送接收分组。与WiFi 不同的是，一个用户仅需要位于基站的数万米范围内。    

上面介绍了接入网的几种场景，以及网络接入技术，包括宽带、光纤、卫星、局域网（包括以太网和 Wifi）
以及广域无线接入网。   

### 1.2.2 物理媒体   

物理媒体的例子包括双绞铜线、同轴电缆、多模光纤缆、陆地无线电频谱和卫星无线电频谱。物理媒体划分为两类：
**引导型媒体**和 **非引导型媒体**。对应引导型媒体，电波沿着固体媒体前行，如光缆、双绞铜线或同轴电缆。
对应非引导型媒体，电波在空气或外层空间中传播，例如在无线局域网或数字卫星频道中。     

+ **1. 双绞铜线**    

双绞线由两根隔离的铜线组成，每根大约1mm 粗，以规则的螺旋形式排列着。这两根线被绞合起来，以减少来自临近类似
的双绞线的电气干扰。通常许多双绞线捆扎在一起形成一根电缆，并在这些双绞线外面覆盖上保护性防护层。
**无屏蔽双绞线**（Unshielded Twisted Pair, UTP）常用于建筑物内的计算机网络中，即用于局域网中。    

+ **2. 同轴电缆**    

与双绞线类似，同轴电缆由两个铜导体组成，但是这两个导体是同心的而不是并行的。借助于这种结构及特殊的绝缘体和保护层，
同轴电缆能够达到较高的数据传输速率。    

+ **3. 光纤**    

光纤是一种细而柔软的、能够引导光脉冲的媒体，每个脉冲表示一个比特。一根光纤能够支持极高的比特速率。它们不受
电磁干扰，光缆信号衰减极低，并且很难窃听。    

+ **4. 陆地无线电信道**    

无线电信道承载电磁频谱中的信号。具有穿透墙壁、提供与移动用户的连接以及长距离承载信号的能力。无线电的特性
极大地依赖于传输环境和传输信号的距离。    

陆地无线电信道能够大致分为三类：一类运行在很短距离（如1米或2米），应该有蓝牙；另一类运行在局域，通常跨越
数十到几百米，WiFi？；第三类运行在广域，跨越数万米。    

+ **5. 卫星无线电信道**    

这个常用在无法使用宽带和光纤的家庭中，端系统可以通过解调器直接和卫星打交道，而上面的陆地
无线电信道，通常是使用基站来收发数据包。    

## 1.3 网络核心

这一节就是介绍网络核心了，就是各种交换机与路由器连接起来的网络。    

### 1.3.1 分组交换

在各种网络应用中，端系统彼此交换 **报文**。为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小
的数据块，称为 **分组**。在源和目的之间，每个分组经过通信链路和分组交换机传送。   

+ **1. 存储转发传输**    

多数分组交换机在链路的输入端使用 **存储转发传输**机制。存储转发机制是指在交换机能够开始向输出链路传输该分组
的第一个比特之前，必须收到整个分组。     

+ **2. 排队时延和分组丢失**    

每个分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机具有一个 **输出缓存**，它用于存储路由器
准备发往那条链路的分组。因此，除了存储转发时延以外，分组还要承受输出缓存的 **排队时延**。    

+ **3. 转发表和路由选择协议**    

在因特网中，每个端系统具有一个称为 IP 地址的地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了
目的地的 IP 地址。如同邮政地址一样，该地址具有一种等级结构。当一个分组到达网络中的路由器时，路由器检查该分组
的目的地地址的一部分，并向一台相邻路由器转发该分组。更特别的是，每台路由器具有一个 **转发表**，用于
将目的地址（或目的地址的一部分）映射称为输出链路。当某分组到达一台路由器时，路由器检查该地址，并用
这个目的地址搜索其转发表，以发现适当的出链路。    

因特网有一些特殊的 **路由选择协议**，用于自动地设置这些转发表。    

### 1.3.2 电路交换

通过网络链路和交换机移动数据有两种基本方法：**电路交换**和**分组交换**。    

在电路交换网络中，在端系统间通信会话期间，预留了端系统间通信沿路径所需要的资源。在分组交换网络中，这些资源是
不预留的。    

+ **1. 电路交换中的复用**    

链路中的电路是通过 **频分复用**（Frequency-Division Multiplexing, FDM）或 **时分复用**
（Time-Division Multiplexing, TDM）来实现的。对于 FDM，链路的频谱由跨越链路创建的所
有连接所共享。特别是，在连接期间为每条连接专用一个频段，该频段的宽度称为带宽。    

对于一条 TDM 链路来说，时间被划分为固定区间的帧，并且每帧又被划分为固定数量的时隙。当网络跨越一条
链路创建一条连接时，网络在每个帧中为该连接指定一个时隙。这些时隙专门有该连接单独使用。    


## 1.4 分组交换网中的时延、丢包和吞吐量

### 1.4.1 分组交换网中的时延概述

当分组从一个节点沿着这条路径到后继节点，该分组在沿途的每个节点经受了几种不同类型的时延。这些时延最为
重要的是 **结点处理时延**、**排队时延**、**传输时延**和 **传播时延**，这些时延总体累积起来是结点总时延。    

1. 处理时延。检查分组首部和决定将该跟组导向何处所需要的时间是 **处理时延**的一部分。
2. 排队时延。
3. 传输时延。用L 比特表示一个分组的长度，用 R bps 表示从路由器 A 到路由器 B 的链路传输速率。传输
时延是 L/R。
4. 从链路的起点到路由器传播所需要的时延是传播时延。    


## 1.5 协议层次及其服务模型

### 1.5.1 分层的体系结构

各层所有的协议被称为 **协议栈** 。因特网的协议栈由5个层次组成：物理层、链路层、网络层、传输层、应用层。    

1. 应用层。应用层协议分布在多个端系统上，一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换
信息的分组。我们把这种位于应用层的信息分组称为 **报文**。    
2. 传输层。传输层在应用程序端点之间传送应用层报文。在因特网中，有两个运行协议，即TCP 和 UDP。我们把传输层
分组称为 **报文段**（segment），报文开始分段嘛。
3. 网路层。因特网中的网路层负责将称为 **数据报**（datagram）的网络层分组从一台主机移动到另一台主机。网络层
包括IP 协议，所有具有网路层的因特网组件必须运行 IP 协议。因特网的网络层也包括决定路由的路由选择协议，它使得数据报根据
该路由从源传输到目的地。因特网具有许多路由选择协议。因特网是一个网络中的网络，在一个网络中，其网络管理者
能够运行所希望的任何路由选择协议。   
4. 链路层。由链路层提供的服务取决与应用于该链路的特定链路层协议。链路层的例子包括以太网、WiFi和电缆接入网
的DOCSIS 协议。因为数据报从源到目的地传送通常协议经过几条链路，一个数据报可能被沿途不同链路上的不同链路
层协议处理。例如，一个数据报可能被一段链路上的以太网和下一段链路上的 PPP 所处理。网路层将受到来自每个不同
的链路层协议的不同服务。在本书中，我们把链路层分组称为 **帧**。
5. 物理层。这层中的协议仍然是链路相关的，并且进一步与该链路的实际传输媒体有关。例如，以太网有许多物理层
协议，一个是关于双绞线的，一个是关于同轴电缆的，还有关于光纤的。    

OSI 模型中的计算机网络分成了7层，在应用层之下是表示层和会话层。要注意的是，其实大部分每个
层都有很多的协议，例如应用层有通用的 HTTP 协议，也有很多应用程序开发者自定的协议，传输层
也至少有 TCP 和 UDP 两种，而网络层也不止是 IP 一种，但是因特网使用的就是 IP 协议，而且还
包含路由选择协议。    

注意以太网和 WiFi 都是链路层协议。   

### 1.5.2 封装

链路层交换机实现了第一层和第二层，路由器实现了第一层到第三层。主机实现了所有5层。    

## 1.6 面对攻击的网络

1. **坏家伙能够经因特网将有害程序放入你的计算机中**     

恶意软件能够以病毒或蠕虫的形式扩散。**病毒**是一种需要某种形式的用户交换来感染用户设备的恶意软件。
**蠕虫**是一种无需任何明显用户交互就能进入设备的恶意软件。例如，用户也许运行一个某攻击者能够发送恶意软件
的脆弱网络程序。在某些情况下，没有用户的任何干预，该应用程序可能从因特网接收恶意软件并运行它，生成了蠕虫。
新近感染设备中的蠕虫则能扫描因特网，搜索其他运行相同易受感染的网络应用程序的主机。当它发现其他易受感染
的主机时，便向这些主机发送自身的副本。那这种情况应该怪应用程序的作者啊，毕竟是软件有漏洞。    

2. **坏家伙能够工具服务器和网络基础设施**     

另一种攻击就是 Dos（Denial-of-Service）了，大多数因特网 DoS 攻击属于下列三种类型之一：   

+ 弱点攻击。这涉及向一台目标主机上运行的易受攻击的应用程序或操作系统发送制作精细的报文。如果适当顺序的
多个分组发送给一个易受攻击的应用程序或操作系统，该服务器可能会停止运行，或者更糟糕的是主机崩溃。
+ 带宽洪泛。攻击者给目标主机发送大量的分组，分组数量之多使得目标的接入链路变得拥塞，使得合法的分组无法到达服务器。
+ 连接洪泛。攻击者在目标主机中创建大量的半开或全开 TCP 连接。该主机因为这些伪造的连接而陷入困境，并
停止接受合法的连接。    

3. **坏家伙能够嗅探分组**     

在无线传输设备的附近放置一台被动的接收机，该接收机就能得到传输的每个分组的副本。记录每个流经的分组副本
的被动接收机被称为**分组嗅探器**。    

嗅探器也能部署在有线环境中，在有线的广播环境中，如在许多以太网 LAN 中，分组嗅探器能够获得经该 LAN 发送的所有分组。这是
怎么部署的，没看懂。    

4. **坏家伙能够伪装成你信任的人**    

生成具有任意源地址、分组内容和目的地址的分组，然后将这个人工制作的分组传输到因特网中极为容易。将具有
虚假源地址的分组注入因特网的能力被称为 **IP 哄骗**。    

## 总结

整章分了6个小节。第一小节介绍了什么是因特网，从两个方面介绍，一方面是组成因特网的各种物理链路与端系统，另一方面
是运行在因特网上的分布式网络应用程序。    

第二小节介绍了网络边缘的内容，包括接入网的几种情形及网络接入技术，之后介绍了网络中传播分组的各种物理媒介。接入
网包括使用 DSL 和同轴电缆、光纤的家庭网络，使用以太网和WiFi 的企业和大学环境，以及广域网的 3G 和 LTE。
物理媒体包括了双绞线、同轴电缆、光纤、陆地无线电频谱和卫星无线电频谱。    

第三小节介绍了网络核心的内容，主要是分组交换网络和电路交换网络。    

第四小节介绍了分组交换网络中存在一些时延、丢包等情况。    

第五小节介绍了当前网络的协议分层情况。    

最后小节介绍了网络安全的情况，介绍了几种网络攻击的情形。    
