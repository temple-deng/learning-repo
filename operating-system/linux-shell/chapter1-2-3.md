# 第一部分 Linux 命令行

<!-- TOC -->

- [第一部分 Linux 命令行](#第一部分-linux-命令行)
- [第 1 章 初始 Linux shell](#第-1-章-初始-linux-shell)
  - [1.1 什么是 Linux](#11-什么是-linux)
    - [1.1.1 Linux 内核](#111-linux-内核)
    - [GNU 工具](#gnu-工具)
    - [1.1.3 Linux 桌面环境](#113-linux-桌面环境)
- [第 2 章 走进 shell](#第-2-章-走进-shell)
  - [2.2 通过 Linux 控制台终端访问 CLI](#22-通过-linux-控制台终端访问-cli)
  - [2.3 通过图形化终端仿真访问 CLI](#23-通过图形化终端仿真访问-cli)
  - [2.4 使用 GNOME Terminal 仿真器](#24-使用-gnome-terminal-仿真器)
  - [2.5 使用 Konsole Terminal 仿真器](#25-使用-konsole-terminal-仿真器)
- [第 3 章 基本的 bash shell 命令](#第-3-章-基本的-bash-shell-命令)
  - [3.1 启动 shell](#31-启动-shell)
  - [3.3 bash 手册](#33-bash-手册)
  - [3.4 浏览文件系统](#34-浏览文件系统)
    - [3.4.1 Linux 文件系统](#341-linux-文件系统)
    - [3.4.2 遍历目录](#342-遍历目录)
  - [3.5 文件和目录列表](#35-文件和目录列表)
  - [3.6 处理文件](#36-处理文件)
    - [3.6.1 创建文件](#361-创建文件)
    - [3.6.2 复制文件](#362-复制文件)
    - [3.6.4 链接文件](#364-链接文件)
    - [3.6.5 重命名文件](#365-重命名文件)
    - [3.6.6 删除文件](#366-删除文件)
  - [3.7 处理目录](#37-处理目录)
    - [3.7.1 创建目录](#371-创建目录)
    - [3.7.2 删除目录](#372-删除目录)
  - [3.8 查看文件内容](#38-查看文件内容)
    - [3.8.1 查看文件类型](#381-查看文件类型)
    - [3.8.2 查看整个文件](#382-查看整个文件)
    - [3.8.3 查看部分文件](#383-查看部分文件)

<!-- /TOC -->

# 第 1 章 初始 Linux shell

## 1.1 什么是 Linux

Linux 可划分为以下四部分：   

+ Linux 内核
+ GNU 工具
+ 图形化桌面环境
+ 应用软件

### 1.1.1 Linux 内核

内核主要负责以下四种功能：   

+ 系统内存管理
+ 软件程序管理
+ 硬件设备管理
+ 文件系统管理   

**软件程序管理**    

内核创建了第一个进程（称为 init 进程）来启动系统上所有其他进程 。当内核启动时，它会将 init 进程
加载到虚拟内存中。内核在启动任何其他进场时，都会在虚拟内存中给新进场分配一块专有区域来存储该进场
用到的数据和代码。   

一些Linux发行版使用一个表来管理在系统开机时要自动启动的进程。在Linux系统上,这个
表通常位于专门文件 /etc/inittab 中。    

另外一些系统（比如 Ubuntu）则采用 /etc/init.d 目录，将开机时启动或停止某个应用的脚本放在这个
目录下。这些脚本通过 /etc/rcX.d/ 目录下的入口 entry 启动，这里的 X 代表 **运行级**。不过这些
入口起始都是到 /etc/init.d/ 目录下可执行文件的符号链接。    

Linux 的 init 系统采用了运行级。运行级决定了 init 进程运行 /etc/inittab 文件或 /etc/rcX.d/
目录中定义好的某些特定类型的进程。Linux 有 5 个启动运行级。   

运行级为 1 时，只启动基本的系统进程以及一个控制台终端进程。我们称之为 **单用户** 模式。单用户
模式通常用来在系统有问题时进行紧急的文件系统维护。显然,在这种模式下,仅有一个人(通常是系统管理员)
能登录到系统上操作数据。    

标准的启动运行级是 3。在这个运行级上，大多数应用软件，比如网络支持程序，都会启动。另一个 Linux
常见的运行级是 5。在这个运行级上系统会启动图形化的 X Window 系统，允许用户通过图形化桌面窗口
登录系统。    

**硬件设备管理**    

任何 Linux 系统需要与之通信的设备，都需要在内核代码中加入其驱动程序代码。在 Linux 内核中有
两种方法用于插入设备驱动代码：   

+ 编译进内核的设备驱动代码
+ 可插入内核的设备驱动魔抗。    

内核模块。它允许将驱动代码插入到运行中的内核而无需重新编译内核。同时，当设备不再使用时也可将内核
模块从内核中移走。这种方式极大地简化和扩展了硬件设备在 Linux 上的使用。    

Linux 系统将硬件设备当成特殊的文件，称为 **设备文件**，设备文件有 3 种分类：   

+ 字符型设备文件
+ 块设备文件
+ 网络设备文件    

网络设备文件是指采用数据包发送和接收数据的设备，包括各种网卡和一个特殊的回环设备。这个回环设备允许
Linux 系统使用常见的网络编程协议同自身通信。   

Linux 为系统上的每个设备都创建一种称为 **节点** 的特殊文件。与设备的所有通信都通过设备节点完成。
每个节点都有唯一的数值对供 Linux 内核标识它。数值对包括一个主设备号和一个次设备号。类似的设备被
划分到同样的主设备号下。    

Linux内核采用虚拟文件系统（ Virtual File System， VFS）作为和每个文件系统交互的接口。
这为Linux内核同任何类型文件系统通信提供了一个标准接口。当每个文件系统都被挂载和使用
时， VFS将信息都缓存在内存中。     


### GNU 工具

**核心 GNU 工具**    

GNU 项目的主旨在于为 Unix 系统管理员设计出一套类似于 Unix 的环境。这个目标促使该项目移植了很多
常见的 Unix 系统命令行工具。供 Linux 系统使用的这组核心工具被称为 coreutils 软件包。   

GNU coreutils 软件包由三部分组成：   

+ 用以处理文件的工具
+ 用以操作文本的工具
+ 用以管理进程的工具    

**shell**   

GNU/Linux shell 是一种特殊的交互式工具。它为用户提供了启动程序、管理文件系统中的文件以及运行
在 Linux 系统上的进程的途径。shell 的核心是命令行提示符。命令行提示符是 shell 负责交换的部分。
它允许你输入文本命令，然后解释命令，并在内核执行。    

shell包含了一组内部命令,用这些命令可以完成诸如复制文件、移动文件、重命名文件、显
示和终止系统中正运行的程序等操作。shell也允许你在命令行提示符中输入程序的名称,它会将
程序名传递给内核以启动它。    

你也可以将多个shell命令放入文件中作为程序执行。这些文件被称作shell脚本。     

### 1.1.3 Linux 桌面环境

Linux 有各种图形化桌面可供选择。    

**X Window系统**    

有两个基本要素决定了视频环境:显卡和显示器。要在电脑上显示绚丽的画面,Linux软件
就得知道如何与这两者互通。X Window软件是图形显示的核心部分。    

X Window软件是直接和PC上的显卡及显示器打交道的底层程序。在Linux世界里,能够实现X Window的
软件包可不止一种。其中最流行的软件包是X.org。    

另外两个X Window软件包也日渐流行。Fedora Linux发行版采用了试验性的Wayland软件;
Ubuntu Linux发行版开发出了Mir显示服务器,用于其桌面环境。    

核心的X Window软件可以产生图形化显示环境,但仅此而已。虽然对于运行独立应用这已
经足够,但在日常PC使用中却并不是那么有用。它没有桌面环境供用户操作文件或是开启程序。为此,你需要
一个建立在X Window系统软件之上的桌面环境。    

**KDE 桌面**    

KDE桌面允许你把应用程序图标和文件图标放置在桌面的特定位置上。单击应用程序图标,
Linux系统就会运行该应用程序。单击文件图标,KDE桌面就会确定使用哪种应用程序来处理该
文件。    

**GNOME 桌面**    

略。   

**Unity 桌面**    

如果你用的是Ubuntu Linux发行版,你会注意到它与KDE和GNOME桌面环境有些不一样。
准确来说,这是因为负责开发Ubuntu的公司决定采用自己的一套叫作Unity的Linux桌面环境。    

# 第 2 章 走进 shell

## 2.2 通过 Linux 控制台终端访问 CLI

在大多数 Linux 发行版中，可以使用简单的按键组合来访问某个 Linux 虚拟控制台。通常必须按下
Ctrl + Alt 组合键，然后按功能键（F1～F7）进入要使用的虚拟控制台。F7 通常就是图形化界面。   

## 2.3 通过图形化终端仿真访问 CLI

在图形化环境下,有大量可用的图形化终端仿真器。尽管可用的图形化终端仿真器软件包不少,但本章只重点
关注其中常用的三个。它们分别是 GNOME Terminal、Konsole Terminal和xterm,通常都会默认安装在
Linux发行版中。    

## 2.4 使用 GNOME Terminal 仿真器

GNOME Terminal是GNOME桌面环境的默认终端仿真器。很多发行版,如RHEL、Fedora和
CentOS,默认采用的都是GNOME桌面环境,因此GNOME Terminal自然也就是默认配备了。不
过其他一些桌面环境,比如Ubuntu Unity,也采用GNOME Terminal作为默认的终端仿真软件包。    

在 Ubuntu 中 Ctrl + Alt + T 可以快速访问 GNOME 终端。    

在大多数桌面环境中,可以创建一个启动器(launcher)访问GNOME Terminal。启动器是桌
面上的一个图标,可以利用它启动一个选定的应用程序。   

## 2.5 使用 Konsole Terminal 仿真器

Konsole Terminal是KDE桌面环境的默认终端仿真器。    

# 第 3 章 基本的 bash shell 命令    

## 3.1 启动 shell

/etc/passwd 文件中包含了所有系统用户账号列表以及每个用户的基本配置信息。类似这样：   

```
christine:x:501:501:Christine Bresnahan:/home/christine:/bin/bash
```    

每个条目有七个字段,字段之间用冒号分隔。系统使用字段中的数据来赋予用户账户某些特
定特性。最后一个字段指定了用户使用的 shell 程序。   

## 3.3 bash 手册

手册页将与命令相关的信息分成了不同的节：   

节 | 描述
----------|---------
 Name | 显示命令名和一段简短的描述
 Synopsis | 命令的语法
 Configuration | 命令配置信息
 Description | 命令的一般性描述
 Options | 命令选项描述
 Exit Status | 命令的退出状态指示
 Return Value | 命令的返回值
 Errors | 命令的错误消息
 Environment | 描述所使用的环境变量
 Files | 命令用到的文件
 Versions | 命令的版本信息
 Conforming To | 命令所遵从的标准
 Notes | 其他有帮助的资料
 Bugs | 提供提交 bug 的途径
 Example | 展示命令的用法

除了对节按照惯例进行命名。手册页还有对应的内容区域、每个内容区域都分配了一个数字，从 1 开始，一直
到 9.    


区域号 | 所涵盖的内容
----------|---------
 1 | 可执行程序或 shell 命令
 2 | 系统调用
 3 | 库调用
 4 | 特殊文件
 5 | 文件格式与约定
 6 | 游戏
 7 | 概览、约定及杂项
 8 | 超级用户和系统管理员命令
 9 | 内核例程

man工具通常提供的是命令所对应的最低编号的内容。要想查看所需要的页面,可以输入 `man section# topic` 。    

## 3.4 浏览文件系统

### 3.4.1 Linux 文件系统

Linux 将文件存储在单个目录结构中，这个目录被称为 **虚拟目录**。虚拟文件将安装在 PC 上的所有存储
设备的文件路径纳入单个目录结构中。   

路径本身并没有提供任何有关文件究竟存储在哪个物理磁盘上的信息。    

Linux 虚拟目录中比较复杂的部分是它如何协调管理各个存储设备。在 Linux PC 上安装的第一块硬盘
称为 **根驱动器**。根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的。   

Linux 会在根驱动器上创建一些特别的目录，我们称之为 **挂载点**。挂载点是虚拟目录中用于分配额外
存储设备的目录。那这个意思是，虚拟目录核心在根驱动器上，但假如我们要将一些目录分配到其他存储设备，
那么就在这个根驱动器上创建一个特殊的目录，这个目录就叫做挂载点。也就说挂载点其实是根驱动器上一个
特殊的目录，目录下的东西都在其他的存储设备上。虚拟目录会让文件和目录出现在这些挂载点目录中，然而
实际上它们却存储在另外一个驱动器中。    

在 Linux 文件系统中，通用的目录名用于表示一些常见的功能。   


目录 | 用途
----------|---------
 \/ | 虚拟目录的根目录
 \/bin | 二进制目录，存放许多用户级 GNU 工具
 \/boot | 启动目录，存放启动文件
 \/dev | 设备目录，Linux 在这里创建设备节点
 \/etc | 系统配置文件目录
 \/home | 主目录，Linux 在这里创建用户目录
 \/lib | 库目录，存放系统和应用程序的库文件
 \/media | 媒体目录，可移动媒体设备的常用挂载点
 \/mnt | 挂载目录，另一个可移动媒体设备的常用挂载点
 \/opt | 可选目录，常用于存放第三方软件包和数据文件
 \/proc | 进场目录，存放现有硬件及当前进程的相关信息
 \/root | root 用户的主目录
 \/sbin | 系统二进制目录，存放许多 GNU 管理员级工具
 \/run | 运行目录，存放系统运作时的运行时数据
 \/srv | 服务目录，存放本地服务的相关文件
 \/sys | 系统目录，存放系统硬件信息的相关文件
 \/tmp | 临时目录，可以在该目录中创建和删除临时工作文件
 \/usr | 用户二进制目录，大量用户级的 GNU 工具和数据文件都存储在这里
 \/var | 可变目录，用以存放经常变化的文件，比如日志文件

常见的目录名均基于文件系统层级标准(filesystem hierarchy standard,FHS)。     

### 3.4.2 遍历目录

切换目录命令 `cd`:   

```bash
$ cd destination
```   

如果没有为 cd 命令指定目标路径，它将切换到用户主目录。   

显示 shell 会话当前目录 `pwd`。   

## 3.5 文件和目录列表

`ls` 命令的最基本形式会显示当前目录下的文件和目录。输出的列表是按字母排序的。如果没有安装彩色
终端仿真器，可以带 `-F` 参数区分文件和目录（目录后会有一个 \/）。在可执行文件后加了星号。      

`-a` 参数显示隐藏文件。   

`ls` 命令支持过滤器，可以在要用的命令行参数之后添加这个过滤器：   

```bash
$ ls -l my_script
-rwxrw-r-- 1 christine christine 54 May 21 11:26 my_script
```   

还支持通配符：问号(\?)代表一个字符，星号(\*)代表零或多个字符。   

在过滤器中使用星号和问好被称为 **文件扩展匹配**（file globbing），指的是使用通配符进行模式匹配
的过程。通配符正式的名称叫做 **元字符通配符**。除了星号和问号之外，还有更多的元字符通配符可用于
文件扩展匹配。   

## 3.6 处理文件

### 3.6.1 创建文件

```bash
$ touch test_one
```   

`touch` 命令还可以用来改变文件的修改时间。如果只想改变访问时间，可用 `-a` 参数。      

`ls` 默认显示的是修改时间，如果想要显示文件的访问时间，`--time=atime`。    


### 3.6.2 复制文件

```bash
$ cp source destination
```   

当 source 和 destination 参数都是文件名时，`cp` 命令将源文件复制成一个新文件。   

也可以将文件复制到现有目录中：   

```bash
$ cp test_one /home/christine/Documents/
```   

使用 `-R` 参数递归地复制整个目录的内容。   

```bash
$ cp -R Scripts/ Mod_Scripts
```   

注意递归复制目的地必须是目录，如果已存在同名的文件，会报错。   

### 3.6.4 链接文件

需要在系统上维护同一文件的两份或多份副本,除了保存多份单独的物理文件副本之外,还可以采用保存一份
物理文件副本和多个虚拟副本的方法。这种虚拟的副本就称为 **链接**。链接是目录中指向文件真实位置的
占位符。在Linux中有两种不同类型的文件链接:   

+ 符号链接
+ 硬链接   

符号链接就是一个实实在在的文件,它指向存放在虚拟目录结构中某个地方的另一个文件。
这两个通过符号链接在一起的文件,彼此的内容并不相同。    

使用 `ln -s` 创建符号链接。    

```bash
$ ln -s data_file sl_data_file
```   

硬链接会创建独立的虚拟文件,其中包含了原始文件的信息及位置。但是它们从根本上而言
是同一个文件。引用硬链接文件等同于引用了源文件。    

**Note:** 只能对处于同一个存储媒体的文件创建硬链接。   

### 3.6.5 重命名文件

```bash
$ mv source new_name/destination
```   

也可以使用 `mv` 移动整个目录：   

```bash
$ mv Mod_Scripts Old_Scripts
```   

### 3.6.6 删除文件

`rm`。    

## 3.7 处理目录

### 3.7.1 创建目录   

`mkdir`。可以加入 `-p` 参数递归地创建目录和子目录。   

### 3.7.2 删除目录

`rmdir` 只删除空目录。使用 `rm -r` 先向下进入目录，删除其中的文件，再删除目录本身。   

## 3.8 查看文件内容

### 3.8.1 查看文件类型

```bash
$ file my_file
my_file: ASCII text
```   

file 还可以区分目录，甚至可以告诉我们符号链接文件链接到哪个文件上。   

file 可以确定二进制可执行程序编译时所面向的平台以及需要何种类型的库。   

```bash
$ file /bin/ls
/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV),
dynamically linked (uses shared libs), for GNU/Linux 2.6.24,
[...]
```     

### 3.8.2 查看整个文件

在 Linux 上有 3 个不同的命令可以查看文件的内容。    

**cat**   

cat 可以查看文本文件。`-n` 加行号。`-b` 给只有文本的行加行号。`-T` 隐藏制表符。`-T` 会用
`^I` 字符组合替换文中所有制表符。   

**more**    

cat 命令的缺陷是：一旦运行，你就无法控制后面的操作。more 会在显示每页数据之后停下来。   

**less**    

less 是 more 的升级版(less is more)。    

### 3.8.3 查看部分文件

**tail**    

默认情况下，显示文件最后 10 行。`-n` 参数来修改所显示的行数。`-f` 允许我们在其他进程使用该文件
时查看文件的内容。tail 命令会保持活动状态，并不断显示添加到文件中的内容，也就说是实时的。      

**head**    

类似 tail。这两个命令都允许我们在破这行后面直接跟想要显示的行数，例如 `head -5`。   

因为文件的开头通常不会改变，因此 head 命令不支持 `-f` 参数。   
