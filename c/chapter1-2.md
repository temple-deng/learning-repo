# 第 1 章 初识 C 语言

## 1.1 语言标准

C 语⾔发展之初，并没有所谓的 C 标准。《C语⾔程序设计》第1版是公认的 C 标准。这本书并没有定义
标准库。C 语⾔⽐其他语⾔更依赖库，因此需要⼀个标准库。实际上，由于缺乏官⽅标准，UNIX 实现提供的
库已成为了标准库。    

### 1.1.1 第 1 个 ANSI/ISO C 标准

随着 C 的不断发展，越来越⼴泛地应⽤于更多系统中，C 社区意识到需要⼀个更全⾯、更新颖、更严格的
标准。鉴于此，美国国家标准协会（ANSI）于 1983 年组建了⼀个委员会，开发了⼀套新标准，并于1989年
正式公布。该标准（ANSI C）定义了 C 语⾔和 C 标准库。国际标准化组织于1990年采⽤了这套 C 标准（ISO C）。
ISO C 和 ANSI C 是完全相同的标准。ANSI/ISO 标准的最终版本通常叫作C89（因为ANSI于1989年批准
该标准）或C90（因为ISO于1990年批准该标准）。另外，由于 ANSI 先公布C标准，因此业界⼈⼠通常使⽤
ANSI C。   

### 1.1.2 C99 标准

1994年，ANSI/ISO联合委员会开始修订 C 标准，最终发布了C99标准。   

### 1.1.3 C11 标准

维护标准任重道远。标准委员会在2007年承诺 C 标准的下⼀个版本是C1X，2011 年终于发布了 C11 标准。
此次，委员会提出了⼀些新的指导原则。   

## 1.2 编程机制

### 1.2.1 目标代码文件、可执行文件和库

C 编程的基本策略是，用程序把源代码文件转换为可执行文件（其中包含可直接运行的机器语言代码）。
典型的 C 实现通过编译和链接两个步骤来完成这一过程。编译器把源代码转换成中间代码，链接器
把中间代码和其他代码合并，生成可执行文件。C 使用这种分而治之的方法方便对程序进行模块化，
可以独立编译单独的模块，稍后再用链接器合并已编译的模块。通过这种方式，如果只更改某个模
块，不必因此重新编译其他模块。另外，链接器还将你编写的程序和预编译的库代码合并。   

中间文件有多种形式。我们在这里描述的是最普遍的一种形式，即把源代码转换为机器语言代码，
并把结果放在目标代码文件（或简称目标文件）中（这里假设源代码只有一个文件）。虽然目标文件中
包含机器语言代码，但是并不能直接运行该文件。因为目标文件中储存的是编译器翻译的源代码，这
还不是一个完整的程序。目标代码文件缺失启动代码（startup code）。启动代码充当着程序和
操作系统之间的接口。例如，可以在MS Windows或Linux系统下运行IBM PC兼容机。这两种情况所
使用的硬件相同，所以目标代码相同，但是Windows和Linux所需的启动代码不同，因为这些系统处
理程序的方式不同。     

目标代码还缺少库函数。几乎所有的 C 程序都要使用 C 标准库中的函数。例如，concrete.c
中就使用了 `printf()` 函数。目标代码文件并不包含该函数的代码，它只包含了使用 `printf()`
函数的指令。`printf()` 函数真正的代码储存在另一个被称为库的文件中。库文件中有许多函数
的目标代码。    

链接器的作用是，把你编写的目标代码、系统的标准启动代码和库代码这 3 部分合并成一个文件，
即可执行文件。对于库代码，链接器只会把程序中要用到的库函数代码提取出来。   

### 1.2.2 GNU 编译器集合和 LLVM 项目

LLVM 项目成为 cc 的另一个替代品。该项目是与编译器相关的开源软件集合，始于伊利诺伊大学的
2000份研究项目。它的 Clang 编译器处理 C 代码，可以通过 clang 调用。有多种版本供不同的
平台使用，包括Linux。2012年，Clang 成为 FreeBSD 的默认 C 编译器。Clang也对最新的 C
标准支持得很好。    

gcc 和 clang 命令都可以根据不同的版本选择运行时选项来调用不同 C 标准。   

```shell
$gcc -std=c99 inform.c
$gcc -std=c1x inform.c
$gcc -std=c11 inform.c
```   

第 1 行调用 C99 标准，第 2 行调用 GCC 接受 C11 之前的草案标准，第 3 行调用 GCC 接受的
C11 标准版本。Clang 编译器在这一点上用法与 GCC 相同。   

# 第 2 章 C 语言概述

本章介绍以下内容：   

- 运算符： =
- 函数： `main()`, `printf()`
- 什么是关键字

## 2.1 简单的 C 程序示例

```c
// 2-1.first.c
#include <stdio.h>

int main(void) {
  int num;
  num = 1;
  printf("I am a simple ");
  printf("computer.\n");
  printf("My favorite number is %d because it is first.\n", num);
  return 0;
}
```   

## 2.2 示例解释

图 2-1 总结了组成 C 程序的几个部分，图中包含的元素比第 1 个程序多。   

![2-1](https://raw.githubusercontent.com/temple-deng/markdown-images/master/clang/2-1.png)

### 2.2.1 快速概要

```c
#include <stdio.h>             // 包含另一个文件
```   

该行告诉编译器把 stdio.h 中的内容包含在当前程序中。stdio.h 是 C 编译器软件包的标准部分，
它提供键盘输入和屏幕输出的支持。    

```c
int main(void)
```    

int 表明 `main()` 函数返回一个整数，void 表明 `main()` 不带任何参数。只需记住，int 和
void 是标准 ANSI C 定义 `main()` 的一部分。    

### 2.2.2 程序细节

1. **#include 指令和头文件**    

`#include <stdio.h>` 的作用相当于把 stdio.h 文件中的所有内容都输入到该行所在的位置。
实际上，这是一种“拷贝-粘贴”的操作。include 文件提供了一种方便的途径共享许多程序共有的信息。    

这行代码是一条 C 预处理器指令（preprocessor directive）。通常，C 编译器在编译前会对
源代码做一些准备工作，即预处理（preprocessing）。   

所有的 C 编译器软件包都提供 stdio.h 文件。该文件中包含了供编译器使用的输入和输出函数信息。
通常，在C程序顶部的信息集合被称为头文件（header）。   

在大多数情况下，头文件包含了编译器创建最终可执行程序要用到的信息。例如，头文件中可以定义
一些常量，或者指明函数名以及如何使用它们。但是，函数的实际代码在一个预编译代码的库文件
中。简而言之，头文件帮助编译器把你的程序正确地组合在一起。   

ANSI/ISO C 规定了 C 编译器必须提供哪些头文件。有些程序要包含 stdio.h，而有些不用。特定
C 实现的文档中应该包含对C库函数的说明。这些说明确定了使用哪些函数需要包含哪些头文件。   

2. **main 函数**   

int 是 `main()` 函数的返回类型。这表明 `main()` 函数返回的值是整数。返回到哪里？返回给
操作系统。我们将在第6章中再来探讨这个问题。   

通常，函数名后面的圆括号中包含一些传入函数的信息。该例中没有传递任何信息。因此，圆括号内
是单词void，如果浏览旧式的C代码，会发现程序以如下形式开始：`main()`。   

C90 标准勉强接受这种形式，但是 C99 和 C11 标准不允许这样写。因此，即使你使用的编译器允许，
也不要这样写。   

3. **注释**    

`//` 这种单行注释方式是 C99 想新增的。    

4. 花括号、函数体和块    

一般而言，所有的 C 函数都使用花括号标记函数体的开始和结束。这是规定，不能省略。   

5. **声明**   

int 是 C语言的一个关键字（keyword），表示一种基本的C语言数据类型。关键字是语言定义的单词，
不能做其他用途。   

在C语言中，所有变量都必须先声明才能使用。这意味着必须列出程序中用到的所有变量名及其类型。   

以前的C语言，还要求把变量声明在块的顶部，其他语句不能在任何声明的前面。C99 和 C11遵循C++
的惯例，可以把声明放在块中的任何位置。   

可以用小写字母、大写字母、数字和下划线（_）来命名。而且，名称的第 1 个字符必须是字母或
下划线，不能是数字。   

操作系统和 C 库经常使用以一个或两个下划线字符开始的标识符（如，_kcab），因此最好避免在
自己的程序中使用这种名称。   

## 2.6 多个函数

```c
// two_func.c 一个文件中包含两个函数
#include <stdio.h>